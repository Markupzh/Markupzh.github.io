<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/M_32px.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/M_16px.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":7,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
<meta property="og:type" content="website">
<meta property="og:title" content="Mark blog">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="Mark blog">
<meta property="og:description" content="半吊子民工 英特纳雄耐尔就一定要实现">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mark">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Mark blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Mark blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">知行合一 划水归档</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/Linux-%E4%B8%AD%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%92%8C%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1-%E4%B8%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Linux-%E4%B8%AD%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%92%8C%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1-%E4%B8%89/" class="post-title-link" itemprop="url">Linux 中的进程和计划任务(三)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-11-03 21:40:53" itemprop="dateCreated datePublished" datetime="2015-11-03T21:40:53+08:00">2015-11-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-01-02 23:54:50" itemprop="dateModified" datetime="2019-01-02T23:54:50+08:00">2019-01-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Linux-中进程的管理"><a href="#Linux-中进程的管理" class="headerlink" title="Linux 中进程的管理"></a>Linux 中进程的管理</h2><h3 id="进程管理工具-kill"><a href="#进程管理工具-kill" class="headerlink" title="进程管理工具 kill"></a>进程管理工具 kill</h3><p><strong>kill命令:</strong> </p>
<pre><code>向进程发送控制信号,以实现对进程管理,每个信号对应一个数字,信号名称以SIG开头 (可省略),不区分大小写 

显示当前系统可用信号: kill –l,trap -l </code></pre><p>​    常用信号:man 7 signal </p>
<p>​    1) SIGHUP: 无须关闭进程而让其重读配置文件 </p>
<p>​    2) SIGINT: 中止正在运行的进程;相当于Ctrl+c </p>
<p>​    3) SIGQUIT:相当于ctrl+\ </p>
<pre><code>9) SIGKILL: 强制杀死正在运行的进程 </code></pre><p>​    15) SIGTERM:终止正在运行的进程 </p>
<p>​    18) SIGCONT:继续运行 </p>
<p>​    19) SIGSTOP:后台休眠 </p>
<pre><code>指定信号的方法: 

(1) 信号的数字标识:1, 2, 9 

(2) 信号完整名称:SIGHUP 

(3) 信号的简写名称:HUP </code></pre><p>按PID:kill [-SIGNAL] pid … </p>
<pre><code>kill –n SIGNAL pid;kill –s SIGNAL pid </code></pre><p>按名称:killall [-SIGNAL] comm… </p>
<p>按模式:pkill [options] pattern </p>
<pre><code>-SIGNAL </code></pre><p>​    -u uid: effective user,生效者 </p>
<pre><code>-U uid: real user,真正发起运行命令者 </code></pre><p>​    -t terminal: 与指定终端相关的进程 </p>
<pre><code>-l: 显示进程名(pgrep可用) 

-a: 显示完整格式的进程名(pgrep可用) </code></pre><p>​    -P pid: 显示指定进程的子进程 </p>
<h3 id="作业管理"><a href="#作业管理" class="headerlink" title="作业管理"></a>作业管理</h3><p> Linux的作业控制 </p>
<pre><code>前台作业:通过终端启动,且启动后一直占据终端 

后台作业:可通过终端启动,但启动后即转入后台运行(释放终端) </code></pre><p> 让作业运行于后台 </p>
<pre><code>(1) 运行中的作业: Ctrl+z 

(2) 尚未启动的作业: COMMAND &amp; </code></pre><p> 后台作业虽然被送往后台运行,但其依然与终端相关;退出终端,将关闭后台作业。如果希望 送往后台后,剥离与终端的关系 </p>
<pre><code>nohup COMMAND &amp;&gt;/dev/null &amp; 

screen;COMMAND </code></pre><p> 查看当前终端所有作业:jobs </p>
<p> 作业控制: </p>
<pre><code>fg [[%]JOB_NUM]:把指定的后台作业调回前台 

bg [[%]JOB_NUM]:让送往后台的作业在后台继续运行 

kill [%JOB_NUM]: 终止指定的作业 </code></pre><h3 id="并行运行"><a href="#并行运行" class="headerlink" title="并行运行"></a>并行运行</h3><p>同时运行多个进程,提高效率 </p>
<p>方法1 </p>
<pre><code>vi all.sh 

f1.sh&amp; 

f2.sh&amp; 

f3.sh&amp; </code></pre><p>方法2 </p>
<pre><code>(f1.sh&amp;);(f2.sh&amp;);(f3.sh&amp;) </code></pre><p>方法3 </p>
<pre><code>{ f1.sh&amp; f2.sh&amp; f3.sh&amp; } </code></pre><h3 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h3><p>Linux任务计划、周期性任务执行 </p>
<pre><code>• 未来的某时间点执行一次任务 

    at 

    batch:系统自行选择空闲时间去执行此处指定的任务 

• 周期性运行某任务 

    cron </code></pre><h4 id="at任务"><a href="#at任务" class="headerlink" title="at任务"></a>at任务</h4><p>包:at </p>
<p> at命令:at [option] TIME </p>
<p> 常用选项: </p>
<pre><code>-V 显示版本信息: 

-l 列出指定队列中等待运行的作业;相当于atq 

-d 删除指定的作业;相当于atrm 

-c 查看具体作业任务 

-f /path/file 指定的文件中读取任务 

-m 当任务被完成之后,将给用户发送邮件,即使没有标准输出 </code></pre><p> 注意:作业执行命令的结果中的标准输出和错误以邮件通知给相关用户 </p>
<p> TIME:定义出什么时候进行 at 这项任务的时间 </p>
<pre><code>HH:MM [YYYY-mm-dd] 

noon, midnight, teatime(4pm) 

tomorrow 

now+#{minutes,hours,days, OR weeks} </code></pre><h4 id="at时间格式"><a href="#at时间格式" class="headerlink" title="at时间格式"></a>at时间格式</h4><p>HH:MM 02:00 </p>
<pre><code>在今日的 HH:MM 进行,若该时刻已过,则明天此时执行任务 </code></pre><p>HH:MM YYYY-MM-DD 02:00 2016-09-20 </p>
<pre><code>规定在某年某月的某一天的特殊时刻进行该项任务 HH:MM[am|pm]/[Month]/[Date] 0

4pm March 17 

17:20 tomorrow </code></pre><p>HH:MM[am|pm] + number [minutes|hours|days|weeks]</p>
<pre><code>在某个时间点再加几个时间后才进行该项任务 

now + 5 min 

02pm + 3 days </code></pre><h4 id="at任务-1"><a href="#at任务-1" class="headerlink" title="at任务"></a>at任务</h4><p>执行方式: </p>
<pre><code>1)交互式 2)输入重定向 3)at –f 文件 </code></pre><p>依赖与atd服务,需要启动才能实现at任务 </p>
<p>at队列存放在/var/spool/at目录中 </p>
<p>/etc/at.{allow,deny}控制用户是否能执行at任务 </p>
<pre><code>白名单:/etc/at.allow 默认不存在,只有该文件中的用户才能执行at命令 

黑名单:/etc/at.deny 默认存在,拒绝该文件中用户执行at命令,而没有在 at.deny 文件中的使用者则可执行 

如果两个文件都不存在,只有 root 可以执行 at 命令 </code></pre><hr>
<h4 id="周期性任务计划-cron"><a href="#周期性任务计划-cron" class="headerlink" title="周期性任务计划 cron"></a>周期性任务计划 cron</h4><p>相关的程序包: </p>
<pre><code>cronie: 主程序包,提供crond守护进程及相关辅助工具 

cronie-anacron:cronie的补充程序,用于监控cronie任务执行状况,如 cronie中的任务在过去该运行的时间点未能正常运行,则anacron会随后启动一次 此任务 

crontabs:包含CentOS提供系统维护任务 </code></pre><h4 id="计划任务-1"><a href="#计划任务-1" class="headerlink" title="计划任务"></a>计划任务</h4><p>确保crond守护处于运行状态: </p>
<pre><code>CentOS 7: 

    systemctl status crond 

CentOS 6: 

    service crond status </code></pre><p>计划周期性执行的任务提交给crond,到指定时间会自动运行 </p>
<pre><code>系统cron任务:系统维护作业 

    /etc/crontab 

用户cron任务: 

    crontab命令 </code></pre><p>日志:/var/log/cron </p>
<p>系统cron任务:/etc/crontab<br>注释行以 # 开头<br>详情参见 man 5 crontab</p>
<p>#Example of job definition:</p>
<p>#.—————- minute (0 - 59)</p>
<p>#| .————- hour (0 - 23)</p>
<p>#| | .———- day of month (1 - 31)</p>
<p>#| | | .——- month (1 - 12) OR jan,feb,mar,apr …</p>
<p>#| | | | .—- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</p>
<p>#| | | | |</p>
<p>#* * * * * user-name command to be executed</p>
<p>例如:晚上9点10分运行echo命令<br>10 21 * * * wang /bin/echo “Howdy!”</p>
<p>时间表示法: </p>
<pre><code>(1) 特定值 给定时间点有效取值范围内的值 

(2) 给定时间点上有效取值范围内的所有值 表示“每...” 

(3) 离散取值 

   #,#,# 

(4) 连续取值 

   #-# 

(5) 在指定时间范围上,定义步长 

   /#: #即为步长 </code></pre><h4 id="时间格式"><a href="#时间格式" class="headerlink" title="时间格式"></a>时间格式</h4><p>@reboot         Run once after reboot </p>
<p>@yearly         0 0 1 1 * </p>
<p>@annually         0 0 1 1 * </p>
<p>@monthly         0 0 1 * * </p>
<p>@weekly         0 0 * * 0 </p>
<p>@daily         0 0 * * * </p>
<p>@hourly         0 * * * * </p>
<p>示例:每3小时echo和wall命令 </p>
<pre><code>0 */3 * * * centos /bin/echo “howdy”;/usr/bin/wall “show time!” </code></pre><p><strong>系统的计划任务</strong></p>
<p>/etc/crontab             配置文件 </p>
<p>/etc/cron.d/             配置文件 </p>
<p>/etc/cron.hourly/         脚本 </p>
<p>/etc/cron.daily/         脚本 </p>
<p>/etc/cron.weekly/     脚本 </p>
<p>/etc/cron.monthly/     脚本 </p>
<h4 id="anacron-系统"><a href="#anacron-系统" class="headerlink" title="anacron 系统"></a>anacron 系统</h4><p>运行计算机关机时cron不运行的任务,CentOS6以后版本取消anacron服务,由 crond服务管理 </p>
<p>对笔记本电脑、台式机、工作站、偶尔要关机的服务器及其它不一直开机的系统 很重要对很有用 </p>
<p>配置文件:/etc/anacrontab,负责执行/etc/ cron.daily /etc/cron.weekly /etc/cron.monthly中系统任务 </p>
<pre><code>• 字段1:如果在这些日子里没有运行这些任务…… 

• 字段2:在重新引导后等待这么多分钟后运行它 

• 字段3:任务识别器,在日志文件中标识 

• 字段4:要执行的任务 </code></pre><p>由/etc/cron.hourly/0anacron执行 </p>
<p>当执行任务时,更新/var/spool/anacron/cron.daily 文件的时间戳 </p>
<h4 id="管理临时文件"><a href="#管理临时文件" class="headerlink" title="管理临时文件"></a>管理临时文件</h4><p>CentOS6使用</p>
<pre><code>/etc/cron.daily/tmpwatch定时清除临时文件 </code></pre><p>CentOS7使用</p>
<pre><code>systemd-tmpfiles-setup服务实现 </code></pre><p>配置文件: </p>
<pre><code>/etc/tmpfiles.d/*.conf *

/run/tmpfiles.d/*.conf *

/usr/lib/tmpfiles/*.conf </code></pre><p>/usr/lib/tmpfiles.d/tmp.conf </p>
<pre><code>d /tmp 1777 root root 10d 

d /var/tmp 1777 root root 30d </code></pre><p>命令: </p>
<pre><code>systemd-tmpfiles –clean|remove|create configfile </code></pre><h4 id="用户计划任务"><a href="#用户计划任务" class="headerlink" title="用户计划任务"></a>用户计划任务</h4><p>crontab命令定义 </p>
<pre><code>每个用户都有专用的cron任务文件: 

    /var/spool/cron/USERNAME </code></pre><p>crontab命令: </p>
<pre><code>crontab [-u user]/[-l | -r | -e]/[-i] 

-l: 列出所有任务 

-e: 编辑任务 

-r: 移除所有任务 

-i:同-r一同使用,以交互式模式移除指定任务 

-u user: 仅root可运行,指定用户管理cron任务 </code></pre><p>控制用户执行计划任务: </p>
<pre><code>/etc/cron.{allow,deny} </code></pre><p><strong>at和crontab</strong></p>
<p>一次性作业使用 at </p>
<p>重复性作业使用crontab </p>
<p>Create         at time             crontab -e </p>
<p>List             at -l             crontab -l </p>
<p>Details         at -c jobnum     N/A </p>
<p>Remove         at -d jobnum     crontab -r </p>
<p>Edit         N/A             crontab -e </p>
<p>没有被重定向的输出会被邮寄给用户 </p>
<p>root能够修改其它用户的作业 </p>
<p>注意:运行结果的标准输出和错误以邮件通知给相关用户 </p>
<pre><code>(1) COMMAND &gt; /dev/null 

(2) COMMAND &amp;&gt; /dev/null </code></pre><p>对于cron任务来讲,%有特殊用途;如果在命令中要使用%,则需要转义,将% 放置于单引号中,则可不用转义 </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/Linux-%E4%B8%AD%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%92%8C%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1-%E4%BA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Linux-%E4%B8%AD%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%92%8C%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1-%E4%BA%8C/" class="post-title-link" itemprop="url">Linux 中的进程和计划任务(二)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-10-31 21:40:47" itemprop="dateCreated datePublished" datetime="2015-10-31T21:40:47+08:00">2015-10-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-01-02 23:46:24" itemprop="dateModified" datetime="2019-01-02T23:46:24+08:00">2019-01-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Linux-中系统资源的管理"><a href="#Linux-中系统资源的管理" class="headerlink" title="Linux 中系统资源的管理"></a>Linux 中系统资源的管理</h2><h3 id="进程管理工具"><a href="#进程管理工具" class="headerlink" title="进程管理工具"></a>进程管理工具</h3><h4 id="top-命令"><a href="#top-命令" class="headerlink" title="top 命令"></a>top 命令</h4><p>top:有许多内置命令 </p>
<p>​    排序: </p>
<p>​        P:以占据的CPU百分比,%CPU </p>
<p>​        M:占据内存百分比,%MEM </p>
<p>​        T:累积占据CPU时长,TIME+ </p>
<p>​    首部信息显示: </p>
<p>​        uptime信息:l命令 </p>
<p>​        tasks及cpu信息:t命令 </p>
<p>​        cpu分别显示:1 (数字) </p>
<p>​        memory信息:m命令 </p>
<p>​    退出命令:q </p>
<p>​    修改刷新时间间隔:s </p>
<p>​    终止指定进程:k </p>
<p>​    保存文件:W </p>
<h4 id="top-命令栏位简介"><a href="#top-命令栏位简介" class="headerlink" title="top 命令栏位简介"></a>top 命令栏位简介</h4><p>​    us:用户空间 </p>
<p>​    sy:内核空间 </p>
<p>​    ni:调整nice时间 </p>
<p>​    id:空闲 </p>
<p>​    wa:等待IO时间 </p>
<p>​    hi:硬中断 </p>
<p>​    si:软中断(模式切换) </p>
<p>​    st:虚拟机偷走的时间 </p>
<h4 id="top命令扩展"><a href="#top命令扩展" class="headerlink" title="top命令扩展"></a>top命令扩展</h4><p>选项: </p>
<p>​    -d # 指定刷新时间间隔，默认为3秒 </p>
<p>​    -b 全部显示所有进程 </p>
<p>​    -n # 刷新多少次后退出 </p>
<p>​    -H 线程模式，示例:top -H -p `pidof mysqld`</p>
<p>htop命令:EPEL源 </p>
<p>​    选项: </p>
<p>​        -d #: 指定延迟时间；</p>
<p>​        -u UserName: 仅显示指定用户的进程 </p>
<p>​        -s COLUME: 以指定字段进行排序 </p>
<p>​    子命令: </p>
<p>​        s:跟踪选定进程的系统调用 </p>
<p>​        l:显示选定进程打开的文件列表 </p>
<p>​        a:将选定的进程绑定至某指定CPU核心 </p>
<p>​        t:显示进程树 </p>
<hr>
<h3 id="内存空间管理"><a href="#内存空间管理" class="headerlink" title="内存空间管理"></a>内存空间管理</h3><h4 id="查看内存空间的使用状态"><a href="#查看内存空间的使用状态" class="headerlink" title="查看内存空间的使用状态:"></a>查看内存空间的使用状态:</h4><p>free [OPTION] </p>
<p>​    -b 以字节为单位 </p>
<p>​    -m 以MB为单位 </p>
<p>​    -g 以GB为单位 </p>
<p>​    -h 易读格式 </p>
<p>​    -o 不显示-/+buffers/cache行 </p>
<p>​    -t 显示RAM + swap的总和 </p>
<p>​    -s n 刷新间隔为n秒 </p>
<p>​    -c n 刷新n次后即退出 </p>
<p>free命令中参数的意义:</p>
<p><img data-src="https://raw.githubusercontent.com/Markupzh/Markupzh.github.io/master/images/post_Linux_Network_1.png" alt=""></p>
<hr>
<h3 id="内存工具"><a href="#内存工具" class="headerlink" title="内存工具"></a>内存工具</h3><h4 id="vmstat命令"><a href="#vmstat命令" class="headerlink" title="vmstat命令"></a>vmstat命令</h4><p>vmstat命令:</p>
<p>​    查看虚拟内存信息 </p>
<p>​    vmstat [options]/[delay [count]] </p>
<p>​    vmstat 2 5  </p>
<p><strong>vmstat参数:</strong></p>
<p>procs: </p>
<p>​    r:可运行(正运行或等待运行)进程的个数，和核心数有关 </p>
<p>​    b:处于不可中断睡眠态的进程个数(被阻塞的队列的长度) </p>
<p>memory: </p>
<p>​    swpd: 交换内存的使用总量 </p>
<p>​    free:空闲物理内存总量 </p>
<p>​    buffer:用于buffer的内存总量 </p>
<p>​    cache:用于cache的内存总量 </p>
<p>swap: </p>
<p>​    si:从磁盘交换进内存的数据速率(kb/s) </p>
<p>​    so:从内存交换至磁盘的数据速率(kb/s) 内存工具 </p>
<p>io: </p>
<p>​    bi:从块设备读入数据到系统的速率(kb/s) </p>
<p>​    bo: 保存数据至块设备的速率 </p>
<p>system: </p>
<p>​    in: interrupts 中断速率，包括时钟 </p>
<p>​    cs: context switch 进程切换速率 </p>
<p>cpu: </p>
<p>​    us:Time spent running non-kernel code </p>
<p>​    sy: Time spent running kernel code </p>
<p>​    id: Time spent idle. Linux 2.5.41前,包括IO-wait time. </p>
<p>​    wa: Time spent waiting for IO. 2.5.41前，包括in idle. </p>
<p>​    st: Time stolen from a virtual machine. 2.6.11前, unknown. </p>
<p>选项:</p>
<p>​     -s: 显示内存的统计数据 </p>
<h4 id="其他内存工具"><a href="#其他内存工具" class="headerlink" title="其他内存工具"></a>其他内存工具</h4><p>iostat:统计CPU和设备IO信息 </p>
<p>​    示例:iostat 1 10 </p>
<p>pmap命令:进程对应的内存映射 </p>
<p>pmap [options] pid […] </p>
<p>​    -x: 显示详细格式的信息 </p>
<p>​    示例:pmap 1 </p>
<p>另外一种实现: </p>
<p>​    cat /proc/PID/maps </p>
<hr>
<h3 id="系统监控工具"><a href="#系统监控工具" class="headerlink" title="系统监控工具"></a>系统监控工具</h3><h4 id="glances-命令"><a href="#glances-命令" class="headerlink" title="glances 命令"></a>glances 命令</h4><p>glances属于第三方EPEL源中的工具</p>
<p>glances [-bdehmnrsvyz1]/[-B bind]/[-c server]/[-C conffile]/[-p port]/[-P password]/[– password]/[-t refresh]/[-f file]/[-o output]</p>
<p>内建命令: </p>
<p>a Sort processes automatically        l Show/hide logs </p>
<p>c Sort processes by CPU%             b Bytes or bits for network I/O </p>
<p>m Sort processes by MEM%         w Delete warning logs </p>
<p>p Sort processes by name             x Delete warning and critical logs </p>
<p>i Sort processes by I/O rate         1 Global CPU or per-CPU stats </p>
<p>d Show/hide disk I/O stats         h Show/hide this help screen </p>
<p>f Show/hide file system stats         t View network I/O as combination </p>
<p>n Show/hide network stats         u View cumulative network I/O </p>
<p>s Show/hide sensors stats             q Quit (Esc and Ctrl-C also work) </p>
<p>y Show/hide hddtemp stats </p>
<p>部分选项解释:</p>
<p>​    -b: 以Byte为单位显示网卡数据速率 </p>
<p>​    -d: 关闭磁盘I/O模块 </p>
<p>​    -f /path/to/somefile: 设定输入文件位置 </p>
<p>​    -o {HTML|CSV}:输出格式 </p>
<p>​    -m: 禁用mount模块 </p>
<p>​    -n: 禁用网络模块 </p>
<p>​    -t #: 延迟时间间隔 </p>
<p>​    -1:每个CPU的相关数据单独显示 </p>
<p>*<em>C/S模式下运行glances命令 *</em></p>
<p>服务器模式: </p>
<p>​    glances -s -B IPADDR </p>
<p>​    IPADDR: 指明监听的本机哪个地址 </p>
<p>客户端模式: </p>
<p>​    glances -c IPADDR </p>
<p>​    IPADDR:要连入的服务器端地址 </p>
<h4 id="dstat-命令"><a href="#dstat-命令" class="headerlink" title="dstat 命令"></a>dstat 命令</h4><p>dstat命令:系统资源统计,代替vmstat,iostat,需要使用yum安装 </p>
<p>dstat [-afv]/[options..]/[delay [count]] </p>
<p>​    -c 显示cpu相关信息 </p>
<p>​    -C #,#,…,total </p>
<p>​    -d 显示disk相关信息 </p>
<p>​    -D total,sda,sdb,… </p>
<p>​    -g 显示page相关统计数据 </p>
<p>​    -m 显示memory相关统计数据 </p>
<p>​    -n 显示network相关统计数据 </p>
<p>​    -p 显示process相关统计数据 </p>
<p>​    -r 显示io请求相关的统计数据 </p>
<p>​    -s 显示swapped相关的统计数据 </p>
<p>​    –tcp </p>
<p>​    –udp </p>
<p>​    –unix </p>
<p>​    –raw </p>
<p>​    –socket </p>
<p>​    –ipc </p>
<p>​    –top-cpu:显示最占用CPU的进程 </p>
<p>​    –top-io: 显示最占用io的进程 </p>
<p>​    –top-mem: 显示最占用内存的进程 </p>
<p>​    –top-latency: 显示延迟最大的进程 </p>
<h4 id="iotop"><a href="#iotop" class="headerlink" title="iotop"></a>iotop</h4><p>iotop命令是一个用来监视磁盘I/O使用状况的top类工具iotop具有与top相似的UI，其中包括 PID、用户、I/O、进程等相关信息，可查看每个进程是如何使用IO </p>
<p>iotop输出 </p>
<p>​    第一行:Read和Write速率总计 </p>
<p>​    第二行:实际的Read和Write速率 </p>
<p>​    第三行:</p>
<p>​        参数如下: </p>
<p>​            线程ID(按p切换为进程ID) </p>
<p>​            优先级 </p>
<p>​            用户 </p>
<p>​            磁盘读速率 </p>
<p>​            磁盘写速率 </p>
<p>​            swap交换百分比 </p>
<p>​            IO等待所占的百分比 </p>
<p>​            线程/进程命令 </p>
<p><strong>iotop 常用参数</strong></p>
<p>​    -o, –only只显示正在产生I/O的进程或线程，除了传参，可以在运行过程中按o 生效 </p>
<p>​    -b, –batch非交互模式，一般用来记录日志 </p>
<p>​    -n NUM, –iter=NUM设置监测的次数，默认无限。在非交互模式下很有用 </p>
<p>​    -d SEC, –delay=SEC设置每次监测的间隔，默认1秒，接受非整形数据例如1.1 </p>
<p>​    -p PID, –pid=PID指定监测的进程/线程 </p>
<p>​    -u USER, –user=USER指定监测某个用户产生的I/O </p>
<p>​    -P, –processes仅显示进程，默认iotop显示所有线程 </p>
<p>​    -a, –accumulated显示累积的I/O，而不是带宽 </p>
<p>​    -k, –kilobytes使用kB单位，而不是对人友好的单位。在非交互模式下，脚本 编程有用 </p>
<p>​    -t, –time 加上时间戳，非交互非模式 </p>
<p>​    -q, –quiet 禁止头几行，非交互模式，有三种指定方式 </p>
<p>​    -q 只在第一次监测时显示列名 </p>
<p>​    -qq 永远不显示列名 </p>
<p>​    -qqq 永远不显示I/O汇总 </p>
<p><strong>iotop 交互按键</strong></p>
<p>​    left和right方向键:改变排序 </p>
<p>​    r:反向排序 </p>
<p>​    o:切换至选项–only </p>
<p>​    p:切换至–processes选项 </p>
<p>​    a:切换至–accumulated选项 </p>
<p>​    q:退出 </p>
<p>​    i:改变线程的优先级 </p>
<h4 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h4><p>Lsof:list open files查看当前系统文件的工具。在linux环境下，一切皆文件，用户通 过文件不仅可以访问常规数据，还可以访问网络连接和硬件如传输控制协议 (TCP) 和 用户数据报协议 (UDP)套接字等，系统在后台都为该应用程序分配了一个文件描述符</p>
<p><strong>命令参数</strong> </p>
<p>​    -a:列出打开文件存在的进程 </p>
<p>​    -c&lt;进程名&gt;:列出指定进程所打开的文件 </p>
<p>​    -g:列出GID号进程详情 </p>
<p>​    -d&lt;文件号&gt;:列出占用该文件号的进程 </p>
<p>​    +d&lt;目录&gt;:列出目录下被打开的文件 </p>
<p>​    +D&lt;目录&gt;:递归列出目录下被打开的文件 </p>
<p>​    -n&lt;目录&gt;:列出使用NFS的文件 </p>
<p>​    -i&lt;条件&gt;:列出符合条件的进程(4、6、协议、:端口、 @ip ) </p>
<p>​    -p&lt;进程号&gt;:列出指定进程号所打开的文件 </p>
<p>​    -u:列出UID号进程详情 </p>
<p>​    -h:显示帮助信息 </p>
<p>​    -v:显示版本信息。 </p>
<p>​    -n: 不反向解析网络名字 </p>
<p><strong>进程管理</strong></p>
<p>查看由登陆用户启动而非系统启动的进程 </p>
<p>​    lsof /dev/pts1 </p>
<p>指定进程号，可以查看该进程打开的文件 </p>
<p>​    lsof -p 9527 </p>
<p><strong>文件管理</strong> </p>
<p>查看指定程序打开的文件 </p>
<p>​    lsof -c httpd </p>
<p>查看指定用户打开的文件 </p>
<p>​    lsof -u root | more </p>
<p>查看指定目录下被打开的文件 </p>
<p>​    lsof +D /var/log/ </p>
<p>​    lsof +d /var/log/ </p>
<p>​    参数+D为递归列出目录下被打开的文件，参数+d为列出目录下被打开的文件 </p>
<p><strong>网络管理</strong> </p>
<p>查看所有网络连接 </p>
<p>​    lsof -i –n lsof <a href="mailto:-i@127.0.0.1">-i@127.0.0.1</a> </p>
<p>​    通过参数-i查看网络连接的情况，包括连接的ip、端口等以及一些服务的连接情况，例如: sshd等。也可以通过指定ip查看该ip的网络连接情况 </p>
<p>查看端口连接情况 </p>
<p>​    lsof -i :80 -n </p>
<p>​    通过参数-i:端口可以查看端口的占用情况，-i参数还有查看协议，ip的连接情况等 </p>
<p>查看指定进程打开的网络连接 </p>
<p>​    lsof -i –n -a -p 9527 </p>
<p>​    参数-i、-a、-p等，-i查看网络连接情况，-a查看存在的进程，-p指定进程 </p>
<p>查看指定状态的网络连接 </p>
<p>​    lsof -n -P -i TCP -s TCP:ESTABLISHED </p>
<p>​    -n:no host names, -P:no port names,-i TCP指定协议，-s指定协议状态通过多个参数可以 清晰的查看网络连接情况、协议连接情况等 </p>
<p><strong>恢复删除文件</strong> </p>
<p>​    lsof |grep /var/log/messages </p>
<p>​    rm -f /var/log/messages </p>
<p>​    lsof |grep /var/log/messages </p>
<p>​    cat /proc/653/fd/6 </p>
<p>​    cat /proc/653/fd/6 &gt; /var/log/messages </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/Linux-%E4%B8%AD%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%92%8C%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1-%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Linux-%E4%B8%AD%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%92%8C%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1-%E4%B8%80/" class="post-title-link" itemprop="url">Linux 中的进程和计划任务(一)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-10-28 20:05:09" itemprop="dateCreated datePublished" datetime="2015-10-28T20:05:09+08:00">2015-10-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-01-02 23:53:28" itemprop="dateModified" datetime="2019-01-02T23:53:28+08:00">2019-01-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Linux-中进程的查看"><a href="#Linux-中进程的查看" class="headerlink" title="Linux 中进程的查看"></a>Linux 中进程的查看</h2><h3 id="进程的相关概念"><a href="#进程的相关概念" class="headerlink" title="进程的相关概念"></a>进程的相关概念</h3><p>内核的功用:进程管理、文件系统、网络功能、内存管理、驱动程序、安全功能等 </p>
<p>Process: 运行中的程序的一个副本,是被载入内存的一个指令集合 </p>
<p>​    进程ID(Process ID,PID)号码被用来标记各个进程UID、GID、和SELinux语境决定对文件系统的存取和访问权限,通常从执行进程的用户来继承存在生命周期 </p>
<p>task struct:Linux内核存储进程信息的数据结构格式 </p>
<p>task list:多个任务的的task struct组成的链表 </p>
<p>进程创建: </p>
<p>​    init:第一个进程 </p>
<p>​    进程:都由其父进程创建,父子关系,CoW fork(), clone() </p>
<h4 id="进程的基本状态和转换"><a href="#进程的基本状态和转换" class="headerlink" title="进程的基本状态和转换"></a>进程的基本状态和转换</h4><p><strong>创建状态:</strong></p>
<p>​    进程在创建时需要申请一个空白PCB(process control block进程控 制块),向其中填写控制和管理进程的信息,完成资源分配.如果创建工作无法完 成,比如资源无法满足,就无法被调度运行,把此时进程所处状态称为创建状态 </p>
<p><strong>就绪状态:</strong></p>
<p>​    进程已准备好,已分配到所需资源,只要分配到CPU就能够立即运行 </p>
<p><strong>执行状态:</strong></p>
<p>​    进程处于就绪状态被调度后,进程进入执行状态 </p>
<p><strong>阻塞状态:</strong></p>
<p>​    正在执行的进程由于某些事件(I/O请求,申请缓存区失败)而暂时 无法运行,进程受到阻塞.在满足请求时进入就绪状态等待系统调用 </p>
<p><strong>终止状态:</strong></p>
<p>​    进程结束,或出现错误,或被系统终止,进入终止状态.无法再执行 </p>
<h4 id="进程之间转换六种情况"><a href="#进程之间转换六种情况" class="headerlink" title="进程之间转换六种情况"></a>进程之间转换六种情况</h4><p>运行——&gt;就绪:</p>
<p>​    1,主要是进程占用CPU的时间过长,而系统分配给该进程占 用CPU的时间是有限的:</p>
<p>​    2,在采用抢先式优先级调度算法的系统中,当有更高 优先级的进程要运行时,该进程就被迫让出CPU,该进程便由执行状态转变为 就绪状态 </p>
<p>就绪——&gt;运行:运行的进程的时间片用完,调度就转到就绪队列中选择合适 的进程分配CPU </p>
<p>运行——&gt;阻塞:正在执行的进程因发生某等待事件而无法执行,则进程由执 行状态变为阻塞状态,如发生了I/O请求 </p>
<p>阻塞——&gt;就绪:进程所等待的事件已经发生,就进入就绪队列 </p>
<p>以下两种状态是不可能发生的: </p>
<p>​    阻塞——&gt;运行:即使给阻塞进程分配CPU,也无法执行,操作系统在进行调 度时不会从阻塞队列进行挑选,而是从就绪队列中选取 </p>
<p>​    就绪——&gt;阻塞:就绪态根本就没有执行,谈不上进入阻塞态 </p>
<h4 id="进程优先级"><a href="#进程优先级" class="headerlink" title="进程优先级"></a>进程优先级</h4><p>进程优先级: </p>
<p>​    系统优先级:数字越小,优先级越高 </p>
<p>​        0-139(CentOS4,5) </p>
<p>​            各有140个运行队列和过期队列 </p>
<p>​        0-98,99(CentOS6) </p>
<p>​    实时优先级: 99-0 值最大优先级最高 </p>
<p>​    nice值:-20到19,对应系统优先级100-139或99 </p>
<p>Big O:时间复杂度,用时和规模的关系 </p>
<p>​    O(1), O(logn), O(n)线性, O(n^2)抛物线, O(2^n) </p>
<h4 id="进程相关概念"><a href="#进程相关概念" class="headerlink" title="进程相关概念"></a>进程相关概念</h4><p>进程内存: </p>
<p>​    Page Frame: 页框,用存储页面数据,存储Page 4k </p>
<p>​    LRU:Least Recently Used 近期最少使用算法,释放内存物理地址空间和线性地址空间 </p>
<p>​    MMU:Memory Management Unit负责转换线性和物理地址 </p>
<p>​    TLB:Translation Lookaside Buffer 翻译后备缓冲器,用于保存虚拟地址和物理地址映射关系的缓存 </p>
<p>IPC: Inter Process Communication </p>
<p>​    同一主机:</p>
<p>​        signal:信号 </p>
<p>​        shm: shared memory </p>
<p>​        semaphore:信号量,一种计数器 </p>
<p>​    不同主机:</p>
<p>​        socket: IP和端口号 </p>
<p>​        RPC: remote procedure call </p>
<p>​        MQ:消息队列,Kafka,ActiveMQ </p>
<h4 id="进程状态"><a href="#进程状态" class="headerlink" title="进程状态"></a>进程状态</h4><p>Linux内核:抢占式多任务 </p>
<p>进程类型: </p>
<p>​    守护进程: daemon,在系统引导过程中启动的进程,和终端无关进程 </p>
<p>​    前台进程:跟终端相关,通过终端启动的进程 </p>
<p>​    注意:两者可相互转化 </p>
<p>进程状态: </p>
<p>​    运行态:running </p>
<p>​    就绪态:ready </p>
<p>​    睡眠态: </p>
<p>​        可中断:interruptable </p>
<p>​        不可中断:uninterruptable </p>
<p>​    停止态:stopped,暂停于内存,但不会被调度,除非手动启动 </p>
<p>​    僵死态:zombie,结束进程,父进程结束前,子进程不关闭 </p>
<hr>
<h3 id="系统管理工具"><a href="#系统管理工具" class="headerlink" title="系统管理工具"></a>系统管理工具</h3><p>进程的分类: </p>
<p>​    CPU-Bound:CPU密集型,非交互 </p>
<p>​    IO-Bound:IO密集型,交互 </p>
<p>Linux系统状态的查看及管理工具:pstree, ps, pidof, pgrep, top, htop, glance, pmap, vmstat, dstat, kill, pkill, job, bg, fg, nohup </p>
<p>pstree命令: </p>
<p>​    pstree - display a tree of processes </p>
<p>ps: process state </p>
<p>​    ps - report a snapshot of the current processes </p>
<p>​    Linux系统各进程的相关信息均保存在/proc/PID目录下的各文件中 </p>
<h4 id="查看系统进程-ps"><a href="#查看系统进程-ps" class="headerlink" title="查看系统进程 ps"></a>查看系统进程 ps</h4><p>ps [OPTION]… </p>
<p>支持三种选项: </p>
<p>​    UNIX选项 如-A -e </p>
<p>​    BSD选项 如a </p>
<p>​    GNU选项 如–help </p>
<p>• 选项:默认显示当前终端中的进程 </p>
<p>• a 选项包括所有终端中的进程 </p>
<p>• x 选项包括不链接终端的进程 </p>
<p>• u 选项显示进程所有者的信息 </p>
<p>• f 选项显示进程树,相当于 –forest </p>
<p>• k|–sort 属性 对属性排序,属性前加- 表示倒序 </p>
<p>• o 属性… 选项显示定制的信息 pid、cmd、%cpu、%mem </p>
<p>• L 显示支持的属性列表 </p>
<h5 id="ps常见选项"><a href="#ps常见选项" class="headerlink" title="ps常见选项"></a>ps常见选项</h5><p>-C cmdlist 指定命令,多个命令用,分隔 </p>
<p>-L 显示线程 </p>
<p>-e: 显示所有进程,相当于-A </p>
<p>-f: 显示完整格式程序信息 </p>
<p>-F: 显示更完整格式的进程信息 </p>
<p>-H: 以进程层级格式显示进程相关信息 </p>
<p>-u userlist 指定有效的用户ID或名称 </p>
<p>-U userlist 指定真正的用户ID或名称 </p>
<p>-g gid或groupname 指定有效的gid或组名称 </p>
<p>-G gid或groupname 指定真正的gid或组名称 </p>
<p>-p pid 显示指pid的进程 </p>
<p>–ppid pid 显示属于pid的子进程 </p>
<p>-M 显示SELinux信息,相当于Z </p>
<h5 id="ps输出属性"><a href="#ps输出属性" class="headerlink" title="ps输出属性"></a>ps输出属性</h5><p>VSZ: Virtual memory SiZe,虚拟内存集,线性内存 </p>
<p>RSS: ReSident Size, 常驻内存集 </p>
<p>STAT:进程状态 </p>
<p>​    R:running </p>
<p>​    S: interruptable sleeping </p>
<p>​    D: uninterruptable sleeping </p>
<p>​    T: stopped </p>
<p>​    Z: zombie </p>
<p>​    +: 前台进程 </p>
<p>​    l: 多线程进程 </p>
<p>​    L:内存分页并带锁 </p>
<p>​    N:低优先级进程 </p>
<p>​    &lt;: 高优先级进程 </p>
<p>​    s: session leader,会话(子进程)发起者 </p>
<h4 id="ps-输出及常见示例"><a href="#ps-输出及常见示例" class="headerlink" title="ps 输出及常见示例"></a>ps 输出及常见示例</h4><p>ni: nice值 </p>
<p>pri: priority 优先级 </p>
<p>psr: processor CPU编号 </p>
<p>rtprio: 实时优先级 </p>
<p>示例: </p>
<p>​    ps axo pid,cmd,psr,ni,pri,rtprio </p>
<p>常用组合: </p>
<p>​    aux </p>
<p>​    -ef </p>
<p>​    -eFH </p>
<p>​    -eo pid,tid,class,rtprio,ni,pri,psr,pcpu,stat,comm </p>
<p>​    axo stat,euid,ruid,tty,tpgid,sess,pgrp,ppid,pid,pcpu,comm </p>
<h5 id="ps示例"><a href="#ps示例" class="headerlink" title="ps示例"></a>ps示例</h5><p>查询你拥有的所有进程: </p>
<p>​    ps -x </p>
<p>显示指定用户名(RUID)或用户ID的进程: </p>
<p>​    ps -fU apache </p>
<p>​    ps -fu 48 </p>
<p>显示指定用户名(EUID)或用户ID的进程: </p>
<p>​    ps -fu mark </p>
<p>​    ps -fu 1000 </p>
<p>查看以root用户权限(实际和有效ID)运行的每个进程: </p>
<p>​    ps -U root -u root </p>
<p>列出某个组拥有的所有进程(实际组ID,RGID或名称): </p>
<p>​    ps -fG nginx </p>
<p>列出有效组名称(或会话)所拥有的所有进程: </p>
<p>​    ps -fg mysql </p>
<p>​    ps -fG 27 </p>
<p>通过进程ID来显示所属的进程: </p>
<p>​    ps -fp 1234 </p>
<p>以父进程ID来显示其下所有的进程,如显示父进程为1154的所有进程: </p>
<p>​    ps -f –ppid 1234 </p>
<p>显示指定PID的多个进程: </p>
<p>​    ps -fp 1204,1239,1263 </p>
<p>要按tty显示所属进程: </p>
<p>​    ps -ft pst/0 </p>
<p>以进程树显示系统中的进程如何相互链接: </p>
<p>​    ps -e –forest </p>
<p>以进程树显示指定的进程 </p>
<p>​    ps -f –forest -C sshd </p>
<p>​    ps -ef –forest | grep -v grep | grep sshd </p>
<p>要显示一个进程的所有线程,将显示LWP(轻量级进程)以及NLWP(轻量级进 程数)列: </p>
<p>​    ps -fL -C nginx </p>
<p>要列出所有格式说明符: </p>
<p>​    ps L </p>
<p>查看进程的PID,PPID,用户名和命令: </p>
<p>​    ps -eo pid,ppid,user,cmd </p>
<p>自定义格式显示文件系统组,ni值开始时间和进程的时间: </p>
<p>​    ps -p 1234 -o pid,ppid,fgroup,ni,lstart,etime </p>
<p>使用其PID查找进程名称: </p>
<p>​    ps -p 1244 -o comm= </p>
<p>要以其名称选择特定进程,显示其所有子进程 </p>
<p>​    ps -C sshd,bash </p>
<p>查找指定进程名所有的所属PID,在编写需要从std输出或文件读取PID的脚本时 这个参数很有用: </p>
<p>​    ps -C httpd,sshd -o pid= </p>
<p>检查一个进程的执行时间 </p>
<p>​    ps -eo comm,etime,user | grep nginx </p>
<p>查找占用最多内存和CPU的进程: </p>
<p>​    ps -eo pid,ppid,cmd,%mem,%cpu –sort=-%mem | head</p>
<p>​    ps -eo pid,ppid,cmd,%mem,%cpu –sort=-%cpu | head </p>
<p>显示安全信息: </p>
<p>​    ps -eM </p>
<p>​    ps –context </p>
<p>使用以下命令以用户定义的格式显示安全信息. </p>
<p>​    ps -eo euser,ruser,suser,fuser,f,comm,label </p>
<p>使用watch实用程序执行重复的输出以实现对就程进行实时的监视,如下面的命 令显示每秒钟的监视: </p>
<p>​    watch -n 1 ‘ps -eo pid,ppid,cmd,%mem,%cpu –sort=-%mem | head’ </p>
<hr>
<h3 id="进程优先级-1"><a href="#进程优先级-1" class="headerlink" title="进程优先级"></a>进程优先级</h3><p>进程优先级调整: </p>
<p>​    静态优先级:100-139 </p>
<p>​    进程默认启动时的nice值为0,优先级为120 </p>
<p>​    只有根用户才能降低nice值(提高优先性) </p>
<p>nice命令: </p>
<p>​    nice [OPTION]/[COMMAND /[ARG]…] </p>
<p>renice命令: </p>
<p>​    renice [-n] priority pid… </p>
<p>查看: </p>
<p>​    ps axo pid,comm,ni </p>
<h4 id="搜索进程"><a href="#搜索进程" class="headerlink" title="搜索进程"></a>搜索进程</h4><p>最灵活:</p>
<p>​    ps 选项 | 其它命令 </p>
<p>按预定义的模式:pgrep </p>
<p>​    pgrep [options] pattern </p>
<p>​    -u uid: effective user,生效者 </p>
<p>​    -U uid: real user,真正发起运行命令者 </p>
<p>​    -t terminal: 与指定终端相关的进程 </p>
<p>​    -l: 显示进程名 </p>
<p>​    -a: 显示完整格式的进程名 </p>
<p>​    -P pid: 显示指定进程的子进程 </p>
<p>按确切的程序名称:/sbin/pidof </p>
<p>​    pidof bash </p>
<h4 id="系统工具"><a href="#系统工具" class="headerlink" title="系统工具"></a>系统工具</h4><p><strong>uptime</strong></p>
<p>显示当前时间,系统已启动的时间、当前上线人数,系统平均负载(1、5、10 分钟的平均负载,一般不会超过1) </p>
<p>系统平均负载: </p>
<p>指在特定时间间隔内运行队列中的平均进程数 </p>
<p>通常每个CPU内核的当前活动进程数不大于3,那么系统的性能良好.如果每 个CPU内核的任务数大于5,那么此主机的性能有严重问题 </p>
<p>如果linux主机是1个双核CPU,当Load Average 为6的时候说明机器已经被 充分使用 </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/Linux-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-%E4%B8%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Linux-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-%E4%B8%89/" class="post-title-link" itemprop="url">Linux 磁盘存储和文件系统(三)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-10-25 20:56:34" itemprop="dateCreated datePublished" datetime="2015-10-25T20:56:34+08:00">2015-10-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-01-02 23:53:03" itemprop="dateModified" datetime="2019-01-02T23:53:03+08:00">2019-01-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="LVM"><a href="#LVM" class="headerlink" title="LVM"></a>LVM</h3><p>允许对卷进行方便操作的抽象层,包括重新设定文件系统的大小 </p>
<p>允许在多个物理设备间重新组织文件系统 </p>
<p>​    • 将设备指定为物理卷 </p>
<p>​    • 用一个或者多个物理卷来创建一个卷组 </p>
<p>​    • 物理卷是用固定大小的物理区域(Physical Extent,PE)来定义的 </p>
<p>​    • 在物理卷上创建的逻辑卷 是由物理区域(PE)组成 </p>
<p>​    • 可以在逻辑卷上创建文件系统 </p>
<h4 id="LVM介绍"><a href="#LVM介绍" class="headerlink" title="LVM介绍"></a>LVM介绍</h4><p>LVM: Logical Volume Manager, Version: 2 </p>
<p>dm: device mapper:将一个或多个底层块设备组织成一个逻辑设备的模块 </p>
<p>设备名:/dev/dm-# </p>
<p>软链接: </p>
<p>​    /dev/mapper/VG_NAME-LV_NAME </p>
<p>​        /dev/mapper/vol0-root </p>
<p>​    /dev/VG_NAME/LV_NAME </p>
<p>​        /dev/vol0/root </p>
<h4 id="pv管理工具"><a href="#pv管理工具" class="headerlink" title="pv管理工具"></a>pv管理工具</h4><p>显示pv信息 </p>
<p>​    pvs:简要pv信息显示 </p>
<p>​    pvdisplay </p>
<p>创建pv </p>
<p>​    pvcreate </p>
<p>​    /dev/DEVICE </p>
<h4 id="vg管理工具"><a href="#vg管理工具" class="headerlink" title="vg管理工具"></a>vg管理工具</h4><p>显示卷组 </p>
<p>​    vgs </p>
<p>​    vgdisplay </p>
<p>创建卷组 </p>
<p>​    vgcreate [-s #[kKmMgGtTpPeE]] VolumeGroupName </p>
<p>​    PhysicalDevicePath [PhysicalDevicePath…] </p>
<p>管理卷组 </p>
<p>​    vgextend VolumeGroupName PhysicalDevicePath [PhysicalDevicePath…] </p>
<p>​    vgreduce VolumeGroupName PhysicalDevicePath [PhysicalDevicePath…] </p>
<p>删除卷组 </p>
<p>​    先做pvmove,</p>
<p>​    再做vgremove </p>
<h4 id="lv管理工具"><a href="#lv管理工具" class="headerlink" title="lv管理工具"></a>lv管理工具</h4><p>显示逻辑卷 </p>
<p>​    lvs </p>
<p>​    Lvdisplay </p>
<p>创建逻辑卷 </p>
<p>​    lvcreate -L #[mMgGtT] -n NAME VolumeGroup </p>
<p>​    lvcreate -l 60%VG -n mylv testvg </p>
<p>​    lvcreate -l 100%FREE -n yourlv testvg </p>
<p>删除逻辑卷 </p>
<p>​    lvremove /dev/VG_NAME/LV_NAME </p>
<p>重设文件系统大小 </p>
<p>​    fsadm [options] resize device [new_size[BKMGTEP]] </p>
<p>​    resize2fs [-f]/[-F]/[-M]/[-P]/[-p] device [new_size]</p>
<h4 id="扩展和缩减逻辑卷"><a href="#扩展和缩减逻辑卷" class="headerlink" title="扩展和缩减逻辑卷"></a>扩展和缩减逻辑卷</h4><p>扩展逻辑卷: </p>
<p>​    lvextend -L [+]#[mMgGtT] /dev/VG_NAME/LV_NAME </p>
<p>​    resize2fs /dev/VG_NAME/LV_NAME </p>
<p>​    lvresize -r -l +100%FREE /dev/VG_NAME/LV_NAME </p>
<p>缩减逻辑卷: </p>
<p>​    umount /dev/VG_NAME/LV_NAME </p>
<p>​    e2fsck -f /dev/VG_NAME/LV_NAME </p>
<p>​    resize2fs /dev/VG_NAME/LV_NAME #[mMgGtT] </p>
<p>​    lvreduce -L [-]#[mMgGtT] /dev/VG_NAME/LV_NAME </p>
<p>​    mount </p>
<h4 id="跨主机迁移卷组"><a href="#跨主机迁移卷组" class="headerlink" title="跨主机迁移卷组"></a>跨主机迁移卷组</h4><p>源计算机上 </p>
<p>​    1 在旧系统中,umount所有卷组上的逻辑卷 </p>
<p>​    2 vgchange –a n vg0 lvdisplay </p>
<p>​    3 vgexport vg0 </p>
<p>​        pvscan </p>
<p>​        vgdisplay </p>
<p>​        拆下旧硬盘 </p>
<p> 在目标计算机上 </p>
<p>​    4 在新系统中安装旧硬盘,并vgimport vg0. </p>
<p>​    5 vgchange –ay vg0 </p>
<p>​    6 mount所有卷组上的逻辑卷 </p>
<h4 id="创建逻辑卷示例"><a href="#创建逻辑卷示例" class="headerlink" title="创建逻辑卷示例"></a>创建逻辑卷示例</h4><p>创建物理卷 </p>
<p>​    pvcreate /dev/sda3 </p>
<p>为卷组分配物理卷 </p>
<p>​    vgcreate vg0 /dev/sda3 </p>
<p>从卷组创建逻辑卷 </p>
<p>​    lvcreate -L 256M -n data vg0 </p>
<p>​    mke2fs -j /dev/vg0/data </p>
<p>mount /dev/vg0/data /mnt/data </p>
<h4 id="逻辑卷管理器快照"><a href="#逻辑卷管理器快照" class="headerlink" title="逻辑卷管理器快照"></a>逻辑卷管理器快照</h4><p>快照是特殊的逻辑卷,它是在生成快照时存在的逻辑卷的准确拷贝 </p>
<p>对于需要备份或者复制的现有数据临时拷贝以及其它操作来说,快照是最合适 的选择 </p>
<p>快照只有在它们和原来的逻辑卷不同时才会消耗空间 </p>
<p>​    在生成快照时会分配给它一定的空间,但只有在原来的逻辑卷或者快照有所 改变才会使用这些空间 </p>
<p>​    当原来的逻辑卷中有所改变时,会将旧的数据复制到快照中。 </p>
<p>​    快照中只含有原来的逻辑卷中更改的数据或者自生成快照后的快照中更改的 数据 </p>
<p>​    建立快照的卷大小只需要原始逻辑卷的15%～20%就够了,也可以使用 lvextend放大快照 </p>
<h4 id="逻辑卷管理器快照-1"><a href="#逻辑卷管理器快照-1" class="headerlink" title="逻辑卷管理器快照"></a>逻辑卷管理器快照</h4><p>快照就是将当时的系统信息记录下来,就好像照相一般,若将来有任何数据 改动了,则原始数据会被移动到快照区,没有改动的区域则由快照区和文件 系统共享 </p>
<p>由于快照区与原本的LV共用很多PE的区块,因此快照与被快照的LV必须在同 一个VG中.系统恢复的时候的文件数量不能高于快照区的实际容量 </p>
<h4 id="使用LVM快照"><a href="#使用LVM快照" class="headerlink" title="使用LVM快照"></a>使用LVM快照</h4><p>为现有逻辑卷创建快照 </p>
<p>​    lvcreate -l 64 -s -n data-snapshot -p r /dev/vg0/data </p>
<p>挂载快照 </p>
<p>​    mkdir -p /mnt/snap </p>
<p>​    mount -o ro /dev/vg0/data-snapshot /mnt/snap </p>
<p>恢复快照 </p>
<p>​    umount /dev/vg0/data-snapshot </p>
<p>​    umount /dev/vg0/data </p>
<p>​    lvconvert –merge /dev/vg0/data-snapshot </p>
<p>删除快照 </p>
<p>​    umount /mnt/databackup </p>
<p>​    lvremove /dev/vg0/databackup </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/Linux-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-%E4%BA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Linux-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-%E4%BA%8C/" class="post-title-link" itemprop="url">Linux 磁盘存储和文件系统(二)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-10-20 20:51:40" itemprop="dateCreated datePublished" datetime="2015-10-20T20:51:40+08:00">2015-10-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-01-02 23:42:18" itemprop="dateModified" datetime="2019-01-02T23:42:18+08:00">2019-01-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="挂载-mount"><a href="#挂载-mount" class="headerlink" title="挂载 mount"></a>挂载 mount</h3><p>挂载:将额外文件系统与根文件系统某现存的目录建立起关联关系,进而使得此 目录做为其它文件访问入口的行为 </p>
<p>卸载:为解除此关联关系的过程 </p>
<p>把设备关联挂载点:mount Point </p>
<p>​    mount </p>
<p>卸载时:可使用设备,也可以使用挂载点 </p>
<p>​    umount </p>
<p>挂载点下原有文件在挂载完成后会被临时隐藏 </p>
<p>挂载点目录一般为空 </p>
<h4 id="用mount命令挂载文件系统"><a href="#用mount命令挂载文件系统" class="headerlink" title="用mount命令挂载文件系统"></a>用mount命令挂载文件系统</h4><p>挂载方法:mount DEVICE MOUNT_POINT </p>
<p>mount:通过查看/etc/mtab文件显示当前已挂载的所有设备 </p>
<p>mount [-fnrsvw]/[-t vfstype]/[-o options] device dir </p>
<p>​    device:指明要挂载的设备； </p>
<p>​    (1) 设备文件:例如/dev/sda5 </p>
<p>​    (2) 卷标:-L ‘LABEL’, 例如 -L ‘MYDATA’ </p>
<p>​    (3) UUID, -U ‘UUID’:例如 -U ‘0c50523c-43f1-45e7- 85c0-a126711d406e’ </p>
<p>​    (4) 伪文件系统名称:proc, sysfs, devtmpfs, configfs </p>
<p>​    dir:挂载点 </p>
<p>​        事先存在；建议使用空目录 </p>
<p>​        进程正在使用中的设备无法被卸载 </p>
<h4 id="mount-常用命令选项"><a href="#mount-常用命令选项" class="headerlink" title="mount 常用命令选项"></a>mount 常用命令选项</h4><p>-t vsftype:指定要挂载的设备上的文件系统类型 </p>
<p>-r: readonly,只读挂载 </p>
<p>-w: read and write, 读写挂载 </p>
<p>-n: 不更新/etc/mtab,mount不可见 </p>
<p>-a:自动挂载所有支持自动挂载的设备(定义在了/etc/fstab文件中,且挂载选 项中有auto功能) </p>
<p>-L ‘LABEL’: 以卷标指定挂载设备 </p>
<p>-U ‘UUID’: 以UUID指定要挂载的设备 </p>
<p>-B, –bind: 绑定目录到另一个目录上 </p>
<p>查看内核追踪到的已挂载的所有设备 </p>
<p>​    cat /proc/mounts </p>
<p> -o options:(挂载文件系统的选项),多个选项使用逗号分隔 </p>
<p>​    async:异步模式 sync:同步模式,内存更改时,同时写磁盘 </p>
<p>​    atime/noatime:包含目录和文件 </p>
<p>​    diratime/nodiratime:目录的访问时间戳 </p>
<p>​    auto/noauto:是否支持自动挂载,是否支持-a选项 </p>
<p>​    exec/noexec:是否支持将文件系统上运行应用程序 </p>
<p>​    dev/nodev:是否支持在此文件系统上使用设备文件 </p>
<p>​    suid/nosuid:是否支持suid和sgid权限 </p>
<p>​    remount:重新挂载 </p>
<p>​    ro:只读 rw:读写 </p>
<p>​    user/nouser:是否允许普通用户挂载此设备,/etc/fstab使用 </p>
<p>​    acl:启用此文件系统上的acl功能 </p>
<p>​    loop: 使用loop设备 </p>
<p> defaults:相当于rw, suid, dev, exec, auto, nouser, async </p>
<h4 id="卸载命令"><a href="#卸载命令" class="headerlink" title="卸载命令"></a>卸载命令</h4><p>查看挂载情况 </p>
<p>​    findmnt MOUNT_POINT|device </p>
<p>查看正在访问指定文件系统的进程 </p>
<p>​    lsof MOUNT_POINT </p>
<p>​    fuser -v MOUNT_POINT </p>
<p>终止所有在正访问指定的文件系统的进程 </p>
<p>​    fuser -km MOUNT_POINT </p>
<p>卸载 </p>
<p>​    umount DEVICE </p>
<p>​    umount MOUNT_POINT </p>
<h4 id="挂载点和-etc-fstab"><a href="#挂载点和-etc-fstab" class="headerlink" title="挂载点和/etc/fstab"></a>挂载点和/etc/fstab</h4><p>配置文件系统体系 </p>
<p>被mount、fsck和其它程序使用 </p>
<p>系统重启时保留文件系统体系 </p>
<p>可以在设备栏使用文件系统卷标 </p>
<p>使用mount -a 命令挂载/etc/fstab中的所有文件系统 </p>
<h4 id="文件挂载配置文件"><a href="#文件挂载配置文件" class="headerlink" title="文件挂载配置文件"></a>文件挂载配置文件</h4><p> /etc/fstab每行定义一个要挂载的文件系统 </p>
<p> 1、要挂载的设备或伪文件系统 </p>
<p>​    设备文件 </p>
<p>​    LABEL:LABEL=”” </p>
<p>​    UUID:UUID=”” </p>
<p>​    伪文件系统名称:proc, sysfs </p>
<p> 2、挂载点 </p>
<p> 3、文件系统类型:ext4,xfs,nfs,none </p>
<p> 4、挂载选项:defaults ,acl,bind </p>
<p> 5、转储频率:</p>
<p>​    0:不做备份 </p>
<p>​    1:每天转储 </p>
<p>​    2:每隔一天转储 </p>
<p> 6、fsck检查的文件系统的顺序:允许的数字是0, 1, 和2 </p>
<p>​    0:不自检 </p>
<p>​    1:首先自检；一般只有rootfs才用 </p>
<p>​    2:非rootfs使用 </p>
<h4 id="处理交换文件和分区"><a href="#处理交换文件和分区" class="headerlink" title="处理交换文件和分区"></a>处理交换文件和分区</h4><p>交换分区是系统RAM的补充 </p>
<p>基本设置包括: </p>
<p>​    • 创建交换分区或者文件 </p>
<p>​    • 使用mkswap写入特殊签名 </p>
<p>​    • 在/etc/fstab文件中添加适当的条目 </p>
<p>​    • 使用swapon -a 激活交换空间 </p>
<h4 id="挂载交换分区"><a href="#挂载交换分区" class="headerlink" title="挂载交换分区"></a>挂载交换分区</h4><p>启用:swapon </p>
<p>​    swapon [OPTION]… [DEVICE] </p>
<p>​        -a:激活所有的交换分区 </p>
<p>​        -p PRIORITY:指定优先级 </p>
<p>​        /etc/fstab:pri=value </p>
<p>禁用:swapoff [OPTION]… [DEVICE] </p>
<h4 id="SWAP的优先级"><a href="#SWAP的优先级" class="headerlink" title="SWAP的优先级"></a>SWAP的优先级</h4><p>可以指定swap分区0到32767的优先级,值越大优先级越高 </p>
<p>如果用户没有指定,那么核心会自动给swap指定一个优先级,这个优先级从 -1开始,每加入一个新的没有用户指定优先级的swap,会给这个优先级减一 </p>
<p>先添加的swap的缺省优先级比较高,除非用户自己指定一个优先级,而用户 指定的优先级(是正数)永远高于核心缺省指定的优先级(是负数) </p>
<p>优化性能:分布存放,高性能磁盘存放 </p>
<h3 id="移动介质"><a href="#移动介质" class="headerlink" title="移动介质"></a>移动介质</h3><p>挂载意味着使外来的文件系统看起来如同是主目录树的一部分 </p>
<p>访问前、介质必须被挂载 </p>
<p>摘除时,介质必须被卸载 </p>
<p>按照默认设置,非根用户只能挂载某些设备（光盘、DVD、软 盘、USB等等） </p>
<p>挂载点通常在/media 或/mnt下 </p>
<h3 id="使用光盘"><a href="#使用光盘" class="headerlink" title="使用光盘"></a>使用光盘</h3><p>在图形环境下自动启动挂载/run/media/[lable]/[lable] </p>
<p>否则就必须被手工挂载 </p>
<p>​    mount /dev/cdrom /mnt/ </p>
<p>eject命令卸载或弹出磁盘 </p>
<p>创建ISO文件 </p>
<p>​    cp /dev/cdrom /root/centos7.iso </p>
<p>​    mkisofs -r -o /root/etc.iso /etc </p>
<p>刻录光盘 </p>
<p>​    wodim –v –eject centos.iso </p>
<h3 id="挂载USB介质"><a href="#挂载USB介质" class="headerlink" title="挂载USB介质"></a>挂载USB介质</h3><p>查看USB设备是否识别 </p>
<p>​    • lsusb </p>
<p>被内核探测为SCSI设备 </p>
<p>​    • /dev/sdaX、/dev/sdbX、或类似的设备文件 </p>
<p>在图形环境中自动挂载 </p>
<p>​    • 图标在[计算机]窗口中创建 </p>
<p>​    • 挂载在/run/media// </p>
<p>手动挂载 • mount /dev/sdb1 /mn </p>
<h4 id="常见工具"><a href="#常见工具" class="headerlink" title="常见工具"></a>常见工具</h4><p>文件系统空间占用等信息的查看工具: </p>
<p>​    df [OPTION]… [FILE]… </p>
<p>​    -H 以1000为单位 </p>
<p>​    -T 文件系统类型 </p>
<p>​    -h: human-readable </p>
<p>​    -i:inodes instead of blocks </p>
<p>​    -P: 以Posix兼容的格式输出 </p>
<p>查看某目录总体空间占用状态: </p>
<p>​    du [OPTION]… DIR </p>
<p>​    -h: human-readable </p>
<p>​    -s: summary –max-depth </p>
<h4 id="工具dd"><a href="#工具dd" class="headerlink" title="工具dd"></a>工具dd</h4><p> dd命令:convert and copy a file </p>
<p> 用法: </p>
<p>​    dd if=/PATH/FROM/SRC of=/PATH/TO/DEST </p>
<p>​    bs=#:block size, 复制单元大小 </p>
<p>​    count=#:复制多少个bs </p>
<p>​    of=file 写到所命名的文件而不是到标准输出 </p>
<p>​    if=file 从所命名文件读取而不是从标准输入 </p>
<p>​    bs=size 指定块大小（既是是ibs也是obs) </p>
<p>​    ibs=size 一次读size个byte </p>
<p>​    obs=size 一次写size个byte </p>
<p>​    cbs=size 一次转化size个byte </p>
<p>​    skip=blocks 从开头忽略blocks个ibs大小的块 </p>
<p>​    seek=blocks 从开头忽略blocks个obs大小的块 </p>
<p>​    count=n 只拷贝n个记录 </p>
<p>conv=conversion[,conversion…] 用指定的参数转换文件 </p>
<p>转换参数: </p>
<p>ascii 转换 EBCDIC 为 ASCII </p>
<p>ebcdic 转换 ASCII 为 EBCDIC </p>
<p>lcase 把大写字符转换为小写字符 </p>
<p>ucase 把小写字符转换为大写字符 </p>
<p>nocreat 不创建输出文件 </p>
<p>noerror 出错时不停止 </p>
<p>notrunc 不截短输出文件 </p>
<p>sync 把每个输入块填充到ibs个字节,不足部分用空(NUL)字符补齐 </p>
<p>备份MBR: </p>
<p>​    dd if=/dev/sda of=/tmp/mbr.bak bs=512 count=1 </p>
<p>破坏MBR中的bootloader: </p>
<p>​    dd if=/dev/zero of=/dev/sda bs=64 count=1 seek=446 </p>
<p>有一个大与2K的二进制文件fileA。现在想从第64个字节位置开始读取,需要读 取的大小是128Byts。又有fileB, 想把上面读取到的128Bytes写到第32个字节开 始的位置,替换128Bytes,实现如下: </p>
<p>​    dd if=fileA of=fileB bs=1 count=128 skip=63 seek=31 conv=notrunc </p>
<p>备份: </p>
<p>​    dd if=/dev/sdx of=/dev/sdy </p>
<p>​    将本地的/dev/sdx整盘备份到/dev/sdy </p>
<p>​    dd if=/dev/sdx of=/path/to/image </p>
<p>​    将/dev/sdx全盘数据备份到指定路径的image文件 </p>
<p>​    dd if=/dev/sdx | gzip &gt;/path/to/image.gz </p>
<p>​    备份/dev/sdx全盘数据,并利用gzip压缩,保存到指定路径 </p>
<p>恢复: </p>
<p>​    dd if=/path/to/image of=/dev/sdx </p>
<p>​    将备份文件恢复到指定盘 </p>
<p>​    gzip -dc /path/to/image.gz | dd of=/dev/sdx </p>
<p>​    将压缩的备份文件恢复到指定盘 </p>
<p>拷贝内存资料到硬盘 </p>
<p>​    dd if=/dev/mem of=/root/mem.bin bs=1024 </p>
<p>将内存里的数据拷贝到root目录下的mem.bin文件 </p>
<p>从光盘拷贝iso镜像 </p>
<p>​    dd if=/dev/cdrom of=/root/cd.iso </p>
<p>拷贝光盘数据到root文件夹下,并保存为cd.iso文件 </p>
<p>销毁磁盘数据 </p>
<p>​    dd if=/dev/urandom of=/dev/sda1 </p>
<p>利用随机的数据填充硬盘,在某些必要的场合可以用来销毁数据,执行此操作以后, /dev/sda1将无法挂载,创建和拷贝操作无法执行 </p>
<p>得到最恰当的block size </p>
<p>​    dd if=/dev/zero bs=1024 count=1000000 of=/root/1Gb.file </p>
<p>​    dd if=/dev/zero bs=2048 count=500000 of=/root/1Gb.file </p>
<p>​    dd if=/dev/zero bs=4096 count=250000 of=/root/1Gb.file </p>
<p>通过比较dd指令输出中命令的执行时间,即可确定系统最佳的block size大小 </p>
<p>测试硬盘写速度 </p>
<p>​    dd if=/dev/zero of=/root/1Gb.file bs=1024 count=1000000 </p>
<p>测试硬盘读速度 </p>
<p>​    dd if=/root/1Gb.file bs=64k | dd of=/dev/null </p>
<p>修复硬盘 </p>
<p>​    dd if=/dev/sda of=/dev/sda </p>
<p>当硬盘较长时间（比如1,2年）放置不使用后,磁盘上会产生消磁点。当磁头读 到这些区域时会遇到困难,并可能导致I/O错误。当这种情况影响到硬盘的第一 个扇区时,可能导致硬盘报废。上边的命令有可能使这些数据起死回生,且这个 过程是安全高效的 </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/Linux-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Linux-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-%E4%B8%80/" class="post-title-link" itemprop="url">Linux 磁盘存储和文件系统(一)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-10-15 20:51:31" itemprop="dateCreated datePublished" datetime="2015-10-15T20:51:31+08:00">2015-10-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-01-02 23:41:39" itemprop="dateModified" datetime="2019-01-02T23:41:39+08:00">2019-01-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="设备文件"><a href="#设备文件" class="headerlink" title="设备文件"></a>设备文件</h4><p>I/O Ports: I/O设备地址 </p>
<p>一切皆文件:open(), read(), write(), close() </p>
<p>设备类型: </p>
<pre><code>块设备:block,存取单位“块”,磁盘 

字符设备:char,存取单位“字符”,键盘 </code></pre><p>设备文件:</p>
<pre><code>关联至一个设备驱动程序,进而能够跟与之对应硬件设备进行通信 </code></pre><p>设备号码: </p>
<pre><code>主设备号:major number, 标识设备类型 

次设备号:minor number, 标识同一类型下的不同设备 </code></pre><p>磁盘设备的设备文件命名:/dev/DEV_FILE </p>
<p>SCSI, SATA, SAS, IDE,USB: /dev/sd </p>
<p>虚拟磁盘:/dev/vd </p>
<p>不同磁盘标识:a-z,aa,ab… </p>
<pre><code>/dev/sda, /dev/sdb, ... </code></pre><p>同一设备上的不同分区:1,2, … </p>
<pre><code>/dev/sda1, /dev/sda5 </code></pre><p>硬盘存储术语 </p>
<pre><code>head:磁头 

track:磁道 

cylinder: 柱面 

sector: 扇区,512bytes </code></pre><h4 id="CHS和LBA"><a href="#CHS和LBA" class="headerlink" title="CHS和LBA"></a>CHS和LBA</h4><p>CHS </p>
<pre><code>采用24bit位寻址 

其中前10位表示cylinder,中间8位表示head,后面6位表示sector 

最大寻址空间8GB </code></pre><p>LBA(logical block addressing) </p>
<p>​    LBA是一个整数,通过转换成CHS格式完成磁盘具体寻址 </p>
<pre><code>LBA采用48个bit位寻址 

最大寻址空间128PB </code></pre><p>由于CHS寻址方式的寻址空间在大概8GB以内,所以在磁盘容量小于大概8GB 时,可以使用CHS寻址方式或是LBA寻址方式;在磁盘容量大于大概8GB时,则 只能使用LBA寻址方式 </p>
<h4 id="使用分区空间"><a href="#使用分区空间" class="headerlink" title="使用分区空间"></a>使用分区空间</h4><p>设备识别 </p>
<p>设备分区 </p>
<p>创建文件系统 </p>
<p>标记文件系统 </p>
<p>在/etc/fstab文件中创建条目 </p>
<p>挂载新的文件系统 </p>
<h3 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h3><h4 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h4><p>两种分区方式:MBR,GPT </p>
<p>MBR: Master Boot Record,1982年,使用32位表示扇区数,分区不超过2T </p>
<p>如何分区:按柱面 </p>
<p>0磁道0扇区:512bytes </p>
<pre><code>446bytes: boot loader 

64bytes:分区表 

    16bytes: 标识一个分区 

2bytes: 55AA </code></pre><p>4个主分区;3主分区+1扩展(N个逻辑分区) </p>
<h4 id="MBR分区结构"><a href="#MBR分区结构" class="headerlink" title="MBR分区结构"></a>MBR分区结构</h4><p>硬盘主引导记录MBR由4个部分组成 </p>
<p>主引导程序(偏移地址0000H–0088H),它负责从活动分区中装载,并运行 系统引导程序 </p>
<p>出错信息数据区,偏移地址0089H–00E1H为出错信息,00E2H–01BDH全为 0字节 </p>
<p>分区表(DPT,Disk Partition Table)含4个分区项,偏移地址01BEH–01FDH, 每个分区表项长16个字节,共64字节为分区项1、分区项2、分区项3、分区项4 </p>
<p>结束标志字,偏移地址01FE–01FF的2个字节值为结束标志55AA </p>
<h4 id="GPT分区"><a href="#GPT分区" class="headerlink" title="GPT分区"></a>GPT分区</h4><p>GPT:GUID(Globals Unique Identifiers) partition table 支持128个分区, 使用64位,支持8Z( 512Byte/block )64Z ( 4096Byte/block) </p>
<p>使用128位UUID(Universally Unique Identifier) 表示磁盘和分区 GPT分区表 自动备份在头和尾两份,并有CRC校验位 </p>
<p>UEFI (统一扩展固件接口)硬件支持GPT,使操作系统启动 </p>
<h3 id="管理分区"><a href="#管理分区" class="headerlink" title="管理分区"></a>管理分区</h3><p>列出块设备 </p>
<pre><code>• lsblk </code></pre><p>创建分区使用: </p>
<pre><code>• fdisk 创建MBR分区 

• gdisk 创建GPT分区 </code></pre><p>​    • parted 高级分区操作 </p>
<p>partprobe－重新设置内存中的内核分区表版本 </p>
<h4 id="parted命令"><a href="#parted命令" class="headerlink" title="parted命令"></a>parted命令</h4><p>parted的操作都是实时生效的,小心使用 </p>
<p>用法:parted [选项]… [设备 [命令 [参数]…]…] </p>
<pre><code>parted /dev/sdb mklabel gpt|msdos 

parted /dev/sdb print 

parted /dev/sdb mkpart primary 1 200 (默认M) 

parted /dev/sdb rm 1 

parted –l 列出分区信息 </code></pre><h4 id="分区工具fdisk和gdisk"><a href="#分区工具fdisk和gdisk" class="headerlink" title="分区工具fdisk和gdisk"></a>分区工具fdisk和gdisk</h4><p>gdisk /dev/sdb 类fdisk 的GPT分区工具 </p>
<pre><code>fdisk -l [ -u]/[device...] 查看分区 

fdisk /dev/sdb 管理分区 

子命令: 

    p 分区列表 

    t 更改分区类型 

    n 创建新分区 

    d 删除分区 

    v 校验分区 

    u 转换单位 

    w 保存并退出 

    q 不保存并退出 </code></pre><h4 id="同步分区表"><a href="#同步分区表" class="headerlink" title="同步分区表"></a>同步分区表</h4><p>查看内核是否已经识别新的分区: </p>
<pre><code>cat /proc/partations </code></pre><p>centos6通知内核重新读取硬盘分区表 </p>
<pre><code>新增分区用 

partx -a /dev/DEVICE 

kpartx -a /dev/DEVICE -f: force 

删除分区用 

partx -d --nr M-N /dev/DEVICE </code></pre><p>CentOS 5,7: 使用partprobe </p>
<p>​    partprobe [/dev/DEVICE] </p>
<p>同步分区表的时候注意系统的版本,centOS 5,7 是相同的,但是6和以上两个版本都不一样</p>
<h3 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h3><p>文件系统是操作系统用于明确存储设备或分区上的文件的方法和数据结构;即 在存储设备上组织文件的方法。操作系统中负责管理和存储文件信息的软件结 构称为文件管理系统,简称文件系统 </p>
<p>从系统角度来看,文件系统是对文件存储设备的空间进行组织和分配,负责文 件存储并对存入的文件进行保护和检索的系统。具体地说,它负责为用户建立 文件,存入、读出、修改、转储文件,控制文件的存取,安全控制,日志,压 缩,加密等 </p>
<p>支持的文件系统:</p>
<pre><code>/lib/modules/\`uname –r`/kernel/fs </code></pre><p>各种文件系统: </p>
<pre><code>https://en.wikipedia.org/wiki/Comparison_of_file_systems </code></pre><h4 id="文件系统类型"><a href="#文件系统类型" class="headerlink" title="文件系统类型"></a>文件系统类型</h4><p> Linux文件系统: </p>
<pre><code>ext2(Extended file system) :适用于那些分区容量不是太大,更新也不频繁的情况,例如 /boot 分区。 

ext3:是 ext2 的改进版本,其支持日志功能,能够帮助系统从非正常关机导致的异常中 恢复。它通常被用作通用的文件系统 

ext4:是 ext 文件系统的最新版。提供了很多新的特性,包括纳秒级时间戳、创建和使 用巨型文件(16TB)、最大1EB的文件系统,以及速度的提升 

xfs:SGI,支持最大8EB的文件系统 

btrfs(Oracle), reiserfs, jfs(AIX), swap </code></pre><p> 光盘:iso9660 </p>
<p> Windows:FAT32, exFAT,NTFS </p>
<p> Unix: FFS(fast), UFS(unix), JFS2 </p>
<p> 网络文件系统:NFS, CIFS </p>
<p> 集群文件系统:GFS2, OCFS2(oracle) </p>
<p> 分布式文件系统: fastdfs,ceph, moosefs, mogilefs, glusterfs, Lustre </p>
<p> RAW:未经处理或者未经格式化产生的文件系统 </p>
<h4 id="文件系统分类"><a href="#文件系统分类" class="headerlink" title="文件系统分类"></a>文件系统分类</h4><p>根据其是否支持”journal”功能: </p>
<pre><code>日志型文件系统: ext3, ext4, xfs, ... 

非日志型文件系统: ext2, vfat </code></pre><p>文件系统的组成部分: </p>
<pre><code>内核中的模块:ext4, xfs, vfat 

用户空间的管理工具:mkfs.ext4, mkfs.xfs,mkfs.vfat </code></pre><p>Linux的虚拟文件系统:VFS </p>
<p>查前支持的文件系统:cat /proc/filesystems </p>
<h4 id="创建文件系统"><a href="#创建文件系统" class="headerlink" title="创建文件系统"></a>创建文件系统</h4><p>mkfs命令: </p>
<p>(1) mkfs.FS_TYPE /dev/DEVICE </p>
<pre><code>ext4 

xfs 

btrfs 

vfat </code></pre><p>(2) mkfs -t FS_TYPE /dev/DEVICE </p>
<pre><code>-L &apos;LABEL&apos;: 设定卷标 </code></pre><h4 id="创建ext文件系统"><a href="#创建ext文件系统" class="headerlink" title="创建ext文件系统"></a>创建ext文件系统</h4><p>mke2fs:ext系列文件系统专用管理工具 </p>
<pre><code>-t {ext2|ext3|ext4} 

-b {1024|2048|4096} 

-L &apos;LABEL&apos; 

-j: 相当于 -t ext3 

    mkfs.ext3 = mkfs -t ext3 = mke2fs -j = mke2fs -t ext3 

-i #: 为数据空间中每多少个字节创建一个inode;此大小不应该小于 block的大小 

-N #:指定分区中创建多少个inode 

-I 一个inode记录占用的磁盘空间大小,128---4096 

-m #: 默认5%,为管理人员预留空间占总空间的百分比 

-O FEATURE[,...]:启用指定特性 

-O ^FEATURE:关闭指定特性 </code></pre><h4 id="文件系统标签"><a href="#文件系统标签" class="headerlink" title="文件系统标签"></a>文件系统标签</h4><p>指向设备的另一种方法 </p>
<p>与设备无关 </p>
<p>blkid:块设备属性信息查看 </p>
<p>blkid [OPTION]… [DEVICE] </p>
<pre><code>-U UUID: 根据指定的UUID来查找对应的设备 

-L LABEL:根据指定的LABEL来查找对应的设备 </code></pre><p>e2label:管理ext系列文件系统的LABEL </p>
<pre><code>e2label DEVICE [LABEL] </code></pre><p>findfs :查找分区 </p>
<pre><code>findfs [options] LABEL= /&lt;/label/&gt;/

findfs [options] UUID= /&lt;/uuid/&gt;/</code></pre><h4 id="tune2fs"><a href="#tune2fs" class="headerlink" title="tune2fs"></a>tune2fs</h4><p>tune2fs:重新设定ext系列文件系统可调整参数的值 </p>
<pre><code>-l:查看指定文件系统超级块信息;super block 

-L &apos;LABEL&apos;:修改卷标 

-m #:修预留给管理员的空间百分比 

-j: 将ext2升级为ext3 

-O: 文件系统属性启用或禁用, –O ^has_journal 

-o: 调整文件系统的默认挂载选项,–o ^acl 

-U UUID: 修改UUID号 </code></pre><p>dumpe2fs: </p>
<pre><code>块分组管理,32768块 

-h:查看超级块信息,不显示分组信息 </code></pre><h4 id="文件系统检测和修复"><a href="#文件系统检测和修复" class="headerlink" title="文件系统检测和修复"></a>文件系统检测和修复</h4><p>常发生于死机或者非正常关机之后 </p>
<p>挂载为文件系统标记为“no clean” </p>
<p>注意:一定不要在挂载状态下修复 </p>
<p>fsck: File System Check </p>
<pre><code>fsck.FS_TYPE 

fsck -t FS_TYPE 

-p: 自动修复错误 

-r: 交互式修复错误 

FS_TYPE一定要与分区上已经文件类型相同 </code></pre><p>e2fsck:ext系列文件专用的检测修复工具 </p>
<pre><code>-y:自动回答为yes 

-f:强制修复 </code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/Linux-%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Linux-%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">Linux 软件包管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-09-10 20:48:27" itemprop="dateCreated datePublished" datetime="2015-09-10T20:48:27+08:00">2015-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-01-02 23:41:18" itemprop="dateModified" datetime="2019-01-02T23:41:18+08:00">2019-01-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="软件运行和编译"><a href="#软件运行和编译" class="headerlink" title="软件运行和编译"></a>软件运行和编译</h3><p>ABI:Application Binary Interface </p>
<p>​    Windows与Linux不兼容 </p>
<p>​        ELF(Executable and Linkable Format) </p>
<p>​        PE（Portable Executable） </p>
<p>​    库级别的虚拟化: </p>
<p>​        Linux: WINE </p>
<p>​        Windows: Cygwin </p>
<p>API:Application Programming Interface </p>
<p>​    POSIX:Portable OS </p>
<p>程序源代码 –&gt; 预处理 –&gt; 编译 –&gt; 汇编 –&gt; 链接 </p>
<p>​    静态编译:.a </p>
<p>​    动态编译:.so </p>
<h4 id="静态和动态链接"><a href="#静态和动态链接" class="headerlink" title="静态和动态链接"></a>静态和动态链接</h4><p>链接主要作用是把各个模块之间相互引用的部分处理好,使得各个模块之间能 够正确地衔接,分为静态链接和动态链接 </p>
<p>静态链接 </p>
<p>​    把程序对应的依赖库复制一份到包 </p>
<p>​    libxxx.a </p>
<p>​    嵌入程序包 </p>
<p>​    升级难,需重新编译 </p>
<p>​    占用较多空间,迁移容易 </p>
<p>动态链接 </p>
<p>​    只把依赖加做一个动态链接 </p>
<p>​    libxxx.so </p>
<p>​    连接指向 </p>
<p>​    占用较少空间,升级方便 </p>
<h3 id="包管理器"><a href="#包管理器" class="headerlink" title="包管理器"></a>包管理器</h3><p>二进制应用程序的组成部分: </p>
<p>​    二进制文件、库文件、配置文件、帮助文件 </p>
<p>程序包管理器: </p>
<p>​    debian:deb文件,dpkg包管理器 </p>
<p>​    redhat:     rpm文件,rpm包管理器 </p>
<p>​    rpm:         Redhat Package Manager </p>
<p>​                RPM Package Manager </p>
<h4 id="包命名"><a href="#包命名" class="headerlink" title="包命名"></a>包命名</h4><p>源代码:name-VERSION.tar.gz|bz2|xz </p>
<p>​    VERSION: major.minor.release </p>
<p>rpm包命名方式: </p>
<p>​    name-VERSION-release.arch.rpm </p>
<p>​    例:bash-4.2.46-19.el7.x86_64.rpm </p>
<p>​    VERSION: major.minor.release </p>
<p>​    release:release.OS </p>
<p>​    常见的arch: </p>
<p>​    x86: i386,i486,i586,i686 </p>
<p>​    x86_64: x64,x86_64,amd64 </p>
<p>​    powerpc: ppc </p>
<p>​    跟平台无关:noarch </p>
<h4 id="包命名和工具"><a href="#包命名和工具" class="headerlink" title="包命名和工具"></a>包命名和工具</h4><p>包:分类和拆包 </p>
<p>​    Application-VERSION-ARCH.rpm: 主包 </p>
<p>​    Application-devel-VERSION-ARCH.rpm 开发子包 </p>
<p>​    Application-utils-VERSION-ARHC.rpm 其它子包 </p>
<p>​    Application-libs-VERSION-ARHC.rpm 其它子包 </p>
<p>包之间:可能存在依赖关系,甚至循环依赖 </p>
<p>解决依赖包管理工具: </p>
<p>​    yum:rpm包管理器的前端工具 </p>
<p>​    apt-get:deb包管理器前端工具 </p>
<p>​    zypper: suse上的rpm前端管理工具 </p>
<p>​    dnf: Fedora 18+ rpm包管理器前端管理工具</p>
<h4 id="库文件"><a href="#库文件" class="headerlink" title="库文件"></a>库文件</h4><p>查看二进制程序所依赖的库文件 </p>
<p>​    ldd /PATH/TO/BINARY_FILE </p>
<p>管理及查看本机装载的库文件 </p>
<p>​    ldconfig 加载库文件 </p>
<p>​    /sbin/ldconfig -p: 显示本机已经缓存的所有可用库文件名及文件路径 映射关系 </p>
<p>​    配置文件:/etc/ld.so.conf,/etc/ld.so.conf.d/*.conf </p>
<p>​    缓存文件:/etc/ld.so.cache </p>
<h4 id="包管理器-1"><a href="#包管理器-1" class="headerlink" title="包管理器"></a>包管理器</h4><p>程序包管理器: </p>
<p>​    功能:将编译好的应用程序的各组成文件打包一个或几个程序包文件,从而 方便快捷地实现程序包的安装、卸载、查询、升级和校验等管理操作 </p>
<p>包文件组成 (每个包独有) </p>
<p>​    RPM包内的文件 </p>
<p>​    RPM的元数据,如名称,版本,依赖性,描述等 </p>
<p>​    安装或卸载时运行的脚本 </p>
<p>数据库(公共):/var/lib/rpm </p>
<p>​    程序包名称及版本 </p>
<p>​    依赖关系 </p>
<p>​    功能说明 </p>
<p>​    包安装后生成的各文件路径及校验码信息 </p>
<h4 id="程序包的来源"><a href="#程序包的来源" class="headerlink" title="程序包的来源"></a>程序包的来源</h4><p>管理程序包的方式: </p>
<p>​    使用包管理器:rpm </p>
<p>​    使用前端工具:yum,dnf </p>
<p>获取程序包的途径: </p>
<p>​    (1) 系统发版的光盘或官方的服务器 </p>
<p>​        CentOS镜像: </p>
<p>​        <a href="https://www.centos.org/download/" target="_blank" rel="noopener">https://www.centos.org/download/</a> </p>
<p>​        <a href="http://mirrors.aliyun.com" target="_blank" rel="noopener">http://mirrors.aliyun.com</a> </p>
<p>​        <a href="http://mirrors.sohu.com" target="_blank" rel="noopener">http://mirrors.sohu.com</a> </p>
<p>​        <a href="http://mirrors.163.com" target="_blank" rel="noopener">http://mirrors.163.com</a> </p>
<p>​    (2) 项目官方站点 </p>
<p>​    (3) 第三方组织: </p>
<p>​        Fedora-EPEL: </p>
<p>​            Extra Packages for Enterprise Linux </p>
<p>​        Rpmforge:RHEL推荐,包很全 </p>
<p>​        搜索引擎: </p>
<p>​            <a href="http://pkgs.org" target="_blank" rel="noopener">http://pkgs.org</a> </p>
<p>​            <a href="http://rpmfind.net" target="_blank" rel="noopener">http://rpmfind.net</a> </p>
<p>​            <a href="http://rpm.pbone.net" target="_blank" rel="noopener">http://rpm.pbone.net</a> </p>
<p>​            <a href="https://sourceforge.net/" target="_blank" rel="noopener">https://sourceforge.net/</a> </p>
<p>​    (4) 自己制作 </p>
<p>​    注意:第三方包建议要检查其合法性 来源合法性,程序包的完整性 </p>
<h3 id="RPM"><a href="#RPM" class="headerlink" title="RPM"></a>RPM</h3><h4 id="rpm包管理"><a href="#rpm包管理" class="headerlink" title="rpm包管理"></a>rpm包管理</h4><p>CentOS系统上使用rpm命令管理程序包: </p>
<p>​    安装、卸载、升级、查询、校验、数据库维护 </p>
<p>​    安装: </p>
<p>​    rpm {-i|–install} [install-options] PACKAGE_FILE… </p>
<p>​        -v: verbose </p>
<p>​        -vv: </p>
<p>​        -h: 以#显示程序包管理执行进度 </p>
<p>​    rpm -ivh PACKAGE_FILE  </p>
<h4 id="rpm包安装"><a href="#rpm包安装" class="headerlink" title="rpm包安装"></a>rpm包安装</h4><p>[install-options] </p>
<p>​    –test: 测试安装,但不真正执行安装,即dry run模式 </p>
<p>​    –nodeps:忽略依赖关系 </p>
<p>​    –replacepkgs | replacefiles </p>
<p>​    –nosignature: 不检查来源合法性 </p>
<p>​    –nodigest:不检查包完整性 </p>
<p>​    –noscripts:不执行程序包脚本 </p>
<p>​        %pre: 安装前脚本     –nopre </p>
<p>​        %post: 安装后脚本 –nopost </p>
<p>​        %preun: 卸载前脚本 –nopreun </p>
<p>​        %postun: 卸载后脚本 –nopostun </p>
<h4 id="rpm包升级"><a href="#rpm包升级" class="headerlink" title="rpm包升级"></a>rpm包升级</h4><p>rpm {-U|–upgrade} [install-options] PACKAGE_FILE… </p>
<p>rpm {-F|–freshen} [install-options] PACKAGE_FILE…     </p>
<p>​    upgrade:安装有旧版程序包,则“升级” 如果不存在旧版程序包,则“安装” </p>
<p>​    freshen:安装有旧版程序包,则“升级” 如果不存在旧版程序包,则不执行升级操作 </p>
<p>​    rpm -Uvh PACKAGE_FILE … </p>
<p>​    rpm -Fvh PACKAGE_FILE … </p>
<p>​    –oldpackage:降级 </p>
<p>​    –force: 强制安装 </p>
<h4 id="升级注意事项"><a href="#升级注意事项" class="headerlink" title="升级注意事项"></a>升级注意事项</h4><p>(1) 不要对内核做升级操作；Linux支持多内核版本并存,因此,对直接安装新版本内核 </p>
<p>(2) 如果原程序包的配置文件安装后曾被修改,升级时,新版本的提供的同一个配 置文件并不会直接覆盖老版本的配置文件,而把新版本的文件重命名 (FILENAME.rpmnew)后保留 </p>
<h4 id="包查询"><a href="#包查询" class="headerlink" title="包查询"></a>包查询</h4><p>rpm {-q|–query} [select-options]/[query-options] </p>
<p>[select-options] </p>
<p>​    -a: 所有包 </p>
<p>​    -f: 查看指定的文件由哪个程序包安装生成 </p>
<p>​    -p rpmfile:针对尚未安装的程序包文件做查询操作 </p>
<p>​    –whatprovides CAPABILITY:查询指定的CAPABILITY由哪个包所提供 </p>
<p>​    –whatrequires CAPABILITY:查询指定的CAPABILITY被哪个包所依赖 </p>
<p>rpm2cpio 包文件|cpio –itv 预览包内文件 </p>
<p>rpm2cpio 包文件|cpio –id “*.conf” 释放包内文件 </p>
<p>[query-options] </p>
<p>​    –changelog:查询rpm包的changelog </p>
<p>​    -c: 查询程序的配置文件 </p>
<p>​    -d: 查询程序的文档 </p>
<p>​    -i: information </p>
<p>​    -l: 查看指定的程序包安装后生成的所有文件 </p>
<p>​    –scripts:程序包自带的脚本 </p>
<p>​    –provides: 列出指定程序包所提供的CAPABILITY </p>
<p>​    -R: 查询指定的程序包所依赖的CAPABILITY </p>
<p>常用查询用法: </p>
<p>​    -qi PACKAGE,</p>
<p>​    -qf FILE,</p>
<p>​    -qc PACKAGE,</p>
<p>​    -ql PACKAGE,</p>
<p>​    -qd PACKAGE </p>
<p>​    -qpi PACKAGE_FILE,</p>
<p>​    -qpl PACKAGE_FILE,… </p>
<p>​    -qa </p>
<p>包卸载: rpm {-e|–erase} [–allmatches]/[–nodeps]/[–noscripts]/[–notriggers]/[–test] PACKAGE_NAME … </p>
<h4 id="包校验"><a href="#包校验" class="headerlink" title="包校验"></a>包校验</h4><p>rpm {-V|–verify} [select-options]/[verify-options] </p>
<p>​    S file Size differs </p>
<p>​    M Mode differs (includes permissions and file type) </p>
<p>​    5 digest (formerly MD5 sum) differs </p>
<p>​    D Device major/minor number mismatch </p>
<p>​    L readLink(2) path mismatch </p>
<p>​    U User ownership differs </p>
<p>​    G Group ownership differs </p>
<p>​    T mTime differs </p>
<p>​    P capabilities differ </p>
<p>包来源合法性验正及完整性验正 </p>
<p>​    完整性验正:SHA256 </p>
<p>​    来源合法性验正:RSA </p>
<p> 公钥加密 </p>
<p>​    对称加密:加密、解密使用同一密钥 </p>
<p>​    非对称加密:密钥是成对儿的 </p>
<p>​        public key: 公钥,公开所有人 </p>
<p>​        secret key: 私钥,不能公开 </p>
<p> 导入所需要公钥 </p>
<p>​    rpm -K|checksig rpmfile 检查包的完整性和签名 </p>
<p>​    rpm –import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7         </p>
<p>​    CentOS 7发行版光盘提供:RPM-GPG-KEY-CentOS-7 </p>
<p>​    rpm -qa “gpg-pubkey*” </p>
<h4 id="rpm数据库"><a href="#rpm数据库" class="headerlink" title="rpm数据库"></a>rpm数据库</h4><p>数据库重建: </p>
<p>​    /var/lib/rpm </p>
<p>rpm {–initdb|–rebuilddb} </p>
<p>​    initdb: 初始化 </p>
<p>​        如果事先不存在数据库,则新建之 </p>
<p>​        否则,不执行任何操作 </p>
<p>​    rebuilddb:重建已安装的包头的数据库索引目录 </p>
<h3 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h3><h4 id="yum包管理"><a href="#yum包管理" class="headerlink" title="yum包管理"></a>yum包管理</h4><p>CentOS: yum,dnf </p>
<p>YUM: Yellowdog Update Modifier,rpm的前端程序,可解决软件包相关依 赖性,可在多个库之间定位软件包,up2date的替代工具 </p>
<p>​    yum repository: yum repo,存储了众多rpm包,以及包的相关的元数据文件（放置于特定目录repodata下） </p>
<p>​    文件服务器: </p>
<p>​        http:// </p>
<p>​        https:// </p>
<p>​        ftp:// </p>
<p>​        file:// </p>
<h4 id="yum配置文件"><a href="#yum配置文件" class="headerlink" title="yum配置文件"></a>yum配置文件</h4><p>yum客户端配置文件: </p>
<p>​    /etc/yum.conf:为所有仓库提供公共配置     </p>
<p>​    /etc/yum.repos.d/*.repo:为仓库的指向提供配置 </p>
<p>​    仓库指向的定义: </p>
<p>​    [repositoryID] </p>
<p>​    name=Some name for this repository </p>
<p>​    baseurl=url://path/to/repository/ enabled={1|0} </p>
<p>​    gpgcheck={1|0} gpgkey=URL enablegroups={1|0} </p>
<p>​    failovermethod={roundrobin|priority} </p>
<p>​        roundrobin:意为随机挑选,默认值 </p>
<p>​        priority:按顺序访问 </p>
<p>​    cost= 默认为1000 </p>
<h4 id="yum仓库"><a href="#yum仓库" class="headerlink" title="yum仓库"></a>yum仓库</h4><p>yum的repo配置文件中可用的变量: </p>
<p>​    $releasever: 当前OS的发行版的主版本号 </p>
<p>​    $arch: 平台,i386,i486,i586,x86_64等 </p>
<p>​    $basearch:基础平台；i386,x86_64 </p>
<p>​    $YUM0-$YUM9:自定义变量 </p>
<p>实例: </p>
<p>​    <a href="http://server/centos/$releasever/$basearch/" target="_blank" rel="noopener">http://server/centos/$releasever/$basearch/</a> </p>
<p>​    <a href="http://server/centos/7/x86_64" target="_blank" rel="noopener">http://server/centos/7/x86_64</a> </p>
<p>​    <a href="http://server/centos/6/i384" target="_blank" rel="noopener">http://server/centos/6/i384</a> </p>
<h4 id="yum源"><a href="#yum源" class="headerlink" title="yum源"></a>yum源</h4><p>阿里云repo文件: </p>
<p>​    <a href="http://mirrors.aliyun.com/repo/" target="_blank" rel="noopener">http://mirrors.aliyun.com/repo/</a> </p>
<p>CentOS系统的yum源 </p>
<p>​    阿里云:</p>
<p>​    <a href="https://mirrors.aliyun.com/centos/$releasever/os/x86_64/" target="_blank" rel="noopener">https://mirrors.aliyun.com/centos/$releasever/os/x86_64/</a>     清华大学:</p>
<p>​    <a href="https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/os/x86_64/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/os/x86_64/</a> </p>
<p>EPEL的yum源: </p>
<p>​    阿里云:</p>
<p>​    <a href="https://mirrors.aliyun.com/epel/$releasever/x86_64" target="_blank" rel="noopener">https://mirrors.aliyun.com/epel/$releasever/x86_64</a> </p>
<h4 id="yum-config-manager"><a href="#yum-config-manager" class="headerlink" title="yum-config-manager"></a>yum-config-manager</h4><p>生成172.16.0.1_cobbler_ks_mirror_CentOS-X-x86_64_.repo </p>
<p>yum-config-manager –add-repo= <a href="http://172.16.0.1/cobbler/ks_mirror/7/" target="_blank" rel="noopener">http://172.16.0.1/cobbler/ks_mirror/7/</a> </p>
<p>yum-config-manager –disable “仓库名” 禁用仓库 </p>
<p>yum-config-manager –enable “仓库名” 启用仓库 </p>
<h4 id="yum命令"><a href="#yum命令" class="headerlink" title="yum命令"></a>yum命令</h4><p>yum命令的用法: </p>
<p>​    yum [options]/[command]/[package …] </p>
<p>显示仓库列表: </p>
<p>​    yum repolist [all|enabled|disabled] </p>
<p>显示程序包: </p>
<p>​    yum list </p>
<p>​    yum list [all | glob_exp1]/[glob_exp2]/[…] </p>
<p>​    yum list {available|installed|updates} [glob_exp1]/[…] </p>
<p>安装程序包: </p>
<p>​    yum install package1 [package2]/[…] </p>
<p>​    yum reinstall package1 [package2]/[…] (重新安装) </p>
<p>升级程序包: </p>
<p>​    yum update [package1]/[package2] /[…] </p>
<p>​    yum downgrade package1 [package2]/[…] (降级) </p>
<p>检查可用升级: </p>
<p>​    yum check-update </p>
<p>卸载程序包: </p>
<p>​    yum remove | erase package1 [package2]/[…] </p>
<p>查看程序包information: </p>
<p>​    yum info […] </p>
<p>查看指定的特性(可以是某文件)是由哪个程序包所提供: </p>
<p>​    yum provides | whatprovides feature1 [feature2]/[…] </p>
<p>清理本地缓存: </p>
<p>​    清除/var/cache/yum/$basearch/$releasever缓存 </p>
<p>​    yum clean [ packages | metadata | expire-cache | rpmdb | plugins | all ] </p>
<p>构建缓存: </p>
<p>​    yum makecache </p>
<p>搜索:yum search string1 [string2]/[…] </p>
<p>​    以指定的关键字搜索程序包名及summary信息 </p>
<p>查看指定包所依赖的capabilities: yum deplist package1 [package2][…] </p>
<p>查看yum事务历史: </p>
<p>​    yum history [info|list|packages-list|packages-info| </p>
<p>​    summary|addon-info|redo|undo| </p>
<p>​    rollback|new|sync|stats] </p>
<p>​    yum history </p>
<p>​    yum history info 6 </p>
<p>​    yum history undo 6 </p>
<p>日志 :/var/log/yum.log </p>
<p>安装及升级本地程序包: </p>
<p>​    yum localinstall rpmfile1 [rpmfile2]/[…] </p>
<p>​    (用install替代) </p>
<p>​    yum localupdate rpmfile1 rpmfile2]/[…] </p>
<p>​    (用update替代) </p>
<p>包组管理的相关命令: </p>
<p>​    yum groupinstall group1 [group2]/[…] </p>
<p>​    yum groupupdate group1 [group2]/[…] </p>
<p>​    yum grouplist [hidden]/[groupwildcard]/[…] </p>
<p>​    yum groupremove group1 [group2]/[…] </p>
<p>​    yum groupinfo group1 […] </p>
<p>yum的命令行选项: </p>
<p>​    –nogpgcheck:禁止进行gpg check </p>
<p>​    -y: 自动回答为“yes” </p>
<p>​    -q:静默模式 </p>
<p>​    –disablerepo=repoidglob:临时禁用此处指定的repo </p>
<p>​    –enablerepo=repoidglob:临时启用此处指定的repo </p>
<p>​    –noplugins:禁用所有插件 </p>
<h4 id="系统光盘的yum仓库"><a href="#系统光盘的yum仓库" class="headerlink" title="系统光盘的yum仓库"></a>系统光盘的yum仓库</h4><p>系统安装光盘作为本地yum仓库: </p>
<p>​    (1) 挂载光盘至某目录,例如/mnt/cdrom </p>
<p>​        mount /dev/cdrom /mnt/cdrom </p>
<p>​    (2) 创建配置文件 </p>
<p>​        [CentOS7] </p>
<p>​        name= </p>
<p>​        baseurl= </p>
<p>​        gpgcheck= </p>
<p>​        enabled= </p>
<p>创建yum仓库: </p>
<p>​    createrepo [options]  <directory></p>
<h3 id="程序包编译"><a href="#程序包编译" class="headerlink" title="程序包编译"></a>程序包编译</h3><p>程序包编译安装: </p>
<p>Application-VERSION-release.src.rpm –&gt; 安装后,使用rpmbuild命令制作 成二进制格式的rpm包,而后再安装 </p>
<p>源代码–&gt;预处理–&gt;编译–&gt;汇编–&gt;链接–&gt;执行 </p>
<p>源代码组织格式: </p>
<p>​    多文件:文件中的代码之间,很可能存在跨文件依赖关系 </p>
<p>​    C、C++:make 项目管理器 </p>
<p>​        configure脚本 –&gt; Makefile.in –&gt; Makefile </p>
<p>​    java: maven </p>
<h4 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h4><p>C语言源代码编译安装三步骤: </p>
<p>​     1、./configure </p>
<p>​    (1) 通过选项传递参数,指定启用特性、安装路径等；执行时会参考用户的 指定以及Makefile.in文件生成Makefile </p>
<p>​    (2) 检查依赖到的外部环境,如依赖的软件包 </p>
<p>​     2、make 根据Makefile文件,构建应用程序 </p>
<p>​     3、make install 复制文件到相应路径 </p>
<p>开发工具: </p>
<p>​    autoconf: 生成configure脚本 </p>
<p>​    automake:生成Makefile.in </p>
<p>注意:安装前查看INSTALL,README </p>
<p>开源程序源代码的获取: </p>
<p>​    官方自建站点: </p>
<p>​    apache.org (ASF:Apache Software Foundation) </p>
<p>​    mariadb.org </p>
<p>​    … </p>
<p>​    代码托管: </p>
<p>​    SourceForge.net </p>
<p>​    Github.com </p>
<p>​    code.google.com </p>
<p>c/c++编译器: gcc (GNU C Complier) </p>
<p>编译C源代码: </p>
<p>​    准备:提供开发工具及开发环境 </p>
<p>​        开发工具:make,gcc等 </p>
<p>​        开发环境:开发库,头文件 </p>
<p>​            glibc:标准库 </p>
<p>​    实现:通过“包组”提供开发组件 </p>
<p>​        Development Tools </p>
<p>​        Server Platform Development </p>
<p>第一步:configure脚本 </p>
<p>​    选项:指定安装位置、指定启用的特性 </p>
<p>​        –help: 获取其支持使用的选项 </p>
<p>​    选项分类: </p>
<p>​        安装路径设定: </p>
<p>​        –prefix=/PATH: 指定默认安装位置,默认为/usr/local/ </p>
<p>​        –sysconfdir=/PATH:配置文件安装位置 </p>
<p>​    System types:支持交叉编译 </p>
<p>​    Optional Features: 可选特性 </p>
<p>​        –disable-FEATURE </p>
<p>​        –enable-FEATURE[=ARG] </p>
<p>​     Optional Packages: 可选包 </p>
<p>​        –with-PACKAGE[=ARG],依赖包 </p>
<p>​        –without-PACKAGE,禁用依赖关系 </p>
<p>​     注意:通常被编译操作依赖的程序包,需要安装此程序包的“开发”组件,其包名 一般类似于name-devel-VERSION </p>
<p>第二步:make </p>
<p>第三步:make install </p>
<p>安装后的配置: </p>
<p>​     (1) 二进制程序目录导入至PATH环境变量中 </p>
<p>​        编辑文件/etc/profile.d/NAME.sh </p>
<p>​        export PATH=/PATH/TO/BIN:$PATH </p>
<p>​     (2) 导入库文件路径 </p>
<p>​        编辑/etc/ld.so.conf.d/NAME.conf </p>
<p>​            添加新的库文件所在目录至此文件中 </p>
<p>​        让系统重新生成缓存: </p>
<p>​            ldconfig [-v] </p>
<p>​    (3) 导入头文件 </p>
<p>​        基于链接的方式实现: </p>
<p>​            ln -sv </p>
<p>​    (4) 导入帮助手册 </p>
<p>​        编辑/etc/man.config|man_db.conf文件 </p>
<p>​        添加一个MANPATH </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mark"
      src="/images/mark_avatar.png">
  <p class="site-author-name" itemprop="name">Mark</p>
  <div class="site-description" itemprop="description">半吊子民工 英特纳雄耐尔就一定要实现</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">64</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:markupzh@gmail.com" title="E-Mail → mailto:markupzh@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mark</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
