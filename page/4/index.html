<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/M_32px.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/M_16px.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":7,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
<meta property="og:type" content="website">
<meta property="og:title" content="Mark blog">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Mark blog">
<meta property="og:description" content="半吊子民工 英特纳雄耐尔就一定要实现">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mark">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Mark blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Mark blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">知行合一 划水归档</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/%E5%8A%A0%E5%AF%86%E4%B8%8E%E5%AE%89%E5%85%A8-%E4%BA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E5%8A%A0%E5%AF%86%E4%B8%8E%E5%AE%89%E5%85%A8-%E4%BA%8C/" class="post-title-link" itemprop="url">加密与安全(二)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-11 13:18:54" itemprop="dateCreated datePublished" datetime="2018-09-11T13:18:54+08:00">2018-09-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-09-20 19:24:42" itemprop="dateModified" datetime="2018-09-20T19:24:42+08:00">2018-09-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="CA和证书"><a href="#CA和证书" class="headerlink" title="CA和证书"></a>CA和证书</h3><p>PKI: Public Key Infrastructure<br>    签证机构:CA(Certificate Authority)<br>    注册机构:RA<br>    证书吊销列表:CRL<br>    证书存取库:<br>X.509:定义了证书的结构以及认证协议标准<br>    版本号</p>
<pre><code>序列号

签名算法

颁发者

有效期限

主体名称

主体公钥

CRL分发点

扩展信息

发行者签名</code></pre><h4 id="证书获取"><a href="#证书获取" class="headerlink" title="证书获取"></a>证书获取</h4><p>证书类型:<br>    证书授权机构的证书<br>    服务器<br>    用户证书<br>获取证书两种方法:<br>    • 使用证书授权机构<br>        生成签名请求(csr)<br>        将csr发送给CA<br>        从CA处接收签名<br>    • 自签名的证书<br>        自已签发自己的公钥    </p>
<h3 id="安全协议"><a href="#安全协议" class="headerlink" title="安全协议"></a>安全协议</h3><p>SSL: Secure Socket Layer,TLS: Transport Layer Security<br>        1995:SSL 2.0 Netscape<br>        1996: SSL 3.0<br>        1999: TLS 1.0<br>        2006: TLS 1.1 IETF(Internet工程任务组) RFC 4346<br>        2008:TLS 1.2 当前使用<br>        2015: TLS 1.3<br>    功能:机密性,认证,完整性,重放保护<br> 两阶段协议,分为握手阶段和应用阶段<br>    握手阶段(协商阶段):客户端和服务器端认证对方身份(依赖于PKI体系,利用数字证书进行身份认证),并协商通信中使用的安全参数、密码套件以及主密钥.后续通信使用的所有密钥都是通过MasterSecret生成.<br>    应用阶段:在握手阶段完成后进入,在应用阶段通信双方使用握手阶段协商好的密钥进行安全通信</p>
<h4 id="SSL-TLS图解"><a href="#SSL-TLS图解" class="headerlink" title="SSL/TLS图解"></a>SSL/TLS图解</h4><p><img data-src="https://github.com/Markupzh/Markupzh.github.io/blob/master/photo/post_secure_safe_03.png" alt=""></p>
<h4 id="SSL-TLS"><a href="#SSL-TLS" class="headerlink" title="SSL/TLS"></a>SSL/TLS</h4><p>Handshake协议:包括协商安全参数和密码套件、服务器身份认证(客户端身份认证可选)、密钥交换<br>ChangeCipherSpec 协议:一条消息表明握手协议已经完成<br>Alert 协议:对握手协议中一些异常的错误提醒,分为fatal和warning两个级别,fatal类型错误会直接中断SSL链接,而Warning级别的错误SSL链接仍可继续,只是会给出错误警告<br>Record 协议:包括对消息的分段、压缩、消息认证和完整性保护、加密等<br>HTTPS 协议:就是“HTTP 协议”和“SSL/TLS 协议”的组合.HTTP over SSL”或“HTTP over TLS”,对http协议的文本数据进行加密处理后,成为二进制形式传输</p>
<h4 id="HTTPS结构"><a href="#HTTPS结构" class="headerlink" title="HTTPS结构"></a>HTTPS结构</h4><p><img data-src="https://github.com/Markupzh/Markupzh.github.io/blob/master/photo/post_secure_safe_04.png" alt=""></p>
<h4 id="HTTPS工作过程"><a href="#HTTPS工作过程" class="headerlink" title="HTTPS工作过程"></a>HTTPS工作过程</h4><p><img data-src="https://github.com/Markupzh/Markupzh.github.io/blob/master/photo/post_secure_safe_05.png" alt=""></p>
<h4 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h4><p>OpenSSL:开源项目<br>    三个组件:<br>        openssl: 多用途的命令行工具,包openssl<br>        libcrypto: 加密算法库,包openssl-libs<br>        libssl:加密模块应用库,实现了ssl及tls,包nss<br>openssl命令:<br>    两种运行模式:交互模式和批处理模式<br>    openssl version:程序版本号<br>    标准命令、消息摘要命令、加密命令<br>    标准命令:<br>        enc, ca, req, …</p>
<h5 id="openssl命令"><a href="#openssl命令" class="headerlink" title="openssl命令"></a>openssl命令</h5><p><strong>对称加密:</strong><br>    工具:openssl enc, gpg<br>    算法:3des, aes, blowfish, twofish<br><strong>enc命令:</strong><br>    帮助:man enc<br>    加密:<br>    openssl enc -e -des3 -a -salt -in testfile -out testfile.cipher<br><strong>解密:</strong><br>    openssl enc -d -des3 -a -salt –in testfile.cipher<br>    -out testfile<br>    openssl ?</p>
<p><strong>单向加密:</strong><br>    工具:md5sum, sha1sum, sha224sum,sha256sum… openssl dgst<br><strong>dgst命令:</strong><br>    帮助:man dgst<br>    openssl dgst -md5 [-hex默认] /PATH/SOMEFILE<br>    openssl dgst -md5 testfile<br>    md5sum /PATH/TO/SOMEFILE<br><strong>MAC:</strong></p>
<p>Message Authentication Code,单向加密的一种延伸应用,用于实现网络通信中保证所传输数据的完整性机制<br>CBC-MAC<br>HMAC:使用md5或sha1算法</p>
<p><strong>生成用户密码:</strong><br>    passwd命令:<br>    帮助:man sslpasswd<br>    openssl passwd -1 -salt SALT(最多8位)<br>    openssl passwd -1 –salt centos<br><strong>生成随机数:</strong><br>    帮助:man sslrand<br>    openssl rand -base64|-hex NUM<br>    NUM: 表示字节数；-hex时,每个字符为十六进制,相当于4位二进制,出现的字符数为NUM*2</p>
<p><strong>公钥加密:</strong><br>    算法:RSA, ELGamal<br>    工具:gpg, openssl rsautl(man rsautl)<br><strong>数字签名:</strong><br>    算法:RSA, DSA, ELGamal<br><strong>密钥交换:</strong><br>    算法:dh<br>    DSA: Digital Signature Algorithm<br>    DSS:Digital Signature Standard<br>    RSA:</p>
<p><strong>生成密钥对:</strong></p>
<p>​    man genrsa</p>
<p><strong>生成私钥:</strong><br>    openssl genrsa -out /PATH/TO/PRIVATEKEY.FILE NUM_BITS<br>    (umask 077; openssl genrsa –out test.key –des 2048)<br>    openssl rsa -in test.key –out test2.key 将加密key解密<br><strong>从私钥中提取出公钥</strong><br>    openssl rsa -in PRIVATEKEYFILE –pubout –out PUBLICKEYFILE<br>    openssl rsa –in test.key –pubout –out test.key.pub<br><strong>随机数生成器:伪随机数字</strong><br>    键盘和鼠标,块设备中断<br>    /dev/random:仅从熵池返回随机数；随机数用尽,阻塞<br>    /dev/urandom:从熵池返回随机数；随机数用尽,会利用软件生成伪随机数,非阻塞</p>
<h4 id="OpenSSL-的几个简单使用"><a href="#OpenSSL-的几个简单使用" class="headerlink" title="OpenSSL 的几个简单使用"></a>OpenSSL 的几个简单使用</h4><p>PKI:Public Key Infrastructure<br>    CA<br>    RA<br>    CRL<br>    证书存取库<br>建立私有CA:<br>    OpenCA<br>    openssl<br>证书申请及签署步骤:<br>    1、生成申请请求<br>    2、RA核验<br>    3、CA签署<br>    4、获取证书</p>
<h4 id="创建CA和申请证书"><a href="#创建CA和申请证书" class="headerlink" title="创建CA和申请证书"></a>创建CA和申请证书</h4><p>创建私有CA:<br>    openssl的配置文件:/etc/pki/tls/openssl.cnf<br>    三种策略:匹配、支持和可选<br>    匹配指要求申请填写的信息跟CA设置信息必须一致,支持指必须填写这项申请信息,可选指可有可无</p>
<h5 id="1-创建所需要的文件"><a href="#1-创建所需要的文件" class="headerlink" title="1.创建所需要的文件"></a>1.创建所需要的文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch &#x2F;etc&#x2F;pki&#x2F;CA&#x2F;index.txt 生成证书索引数据库文件</span><br><span class="line">echo 01 &gt; &#x2F;etc&#x2F;pki&#x2F;CA&#x2F;serial 指定第一个颁发证书的序列号</span><br></pre></td></tr></table></figure>

<h5 id="2-CA自签证书"><a href="#2-CA自签证书" class="headerlink" title="2.CA自签证书"></a>2.CA自签证书</h5><p>生成私钥<br>    cd /etc/pki/CA/<br>    (umask 066; openssl genrsa -out etc/pki/CA/private/cakey.pem 2048)</p>
<p>生成自签名证书<br>openssl req -new -x509 –key<br>/etc/pki/CA/private/cakey.pem -days 7300 -out<br>/etc/pki/CA/cacert.pem<br>    -new:                             生成新证书签署请求<br>    -x509:                             专用于CA生成自签证书<br>    -key:                             生成请求时用到的私钥文件<br>    -days n:                        证书的有效期限<br>    -out /PATH/TO/SOMECERTFILE:     证书的保存路径</p>
<h5 id="3-颁发证书"><a href="#3-颁发证书" class="headerlink" title="3.颁发证书"></a>3.颁发证书</h5><p>在需要使用证书的主机生成证书请求<br>    给web服务器生成私钥<br>    (umask 066; openssl genrsa -out /etc/pki/tls/private/test.key 2048)<br>    生成证书申请文件<br>    openssl req -new -key /etc/pki/tls/private/test.key -days 365 -out etc/pki/tls/test.csr<br>将证书请求文件传输给CA<br>CA签署证书,并将证书颁发给请求者<br>    openssl ca -in /tmp/test.csr –out<br>    /etc/pki/CA/certs/test.crt -days 365<br>注意:默认国家,省,公司名称三项必须和CA一致</p>
<p>查看证书中的信息:<br>    openssl x509 -in /PATH/FROM/CERT_FILE -noout - text|issuer|subject|serial|dates<br>    openssl ca -status SERIAL 查看指定编号的证书状态</p>
<h5 id="4-吊销证书"><a href="#4-吊销证书" class="headerlink" title="4.吊销证书"></a>4.吊销证书</h5><p> 在客户端获取要吊销的证书的serial<br>    openssl x509 -in /PATH/FROM/CERT_FILE -noout -serial - subject<br> 在CA上,根据客户提交的serial与subject信息,对比检验是否与index.txt文件中的信息一致,<br>吊销证书:<br>    openssl ca -revoke /etc/pki/CA/newcerts/SERIAL.pem<br> 指定第一个吊销证书的编号,注意:第一次更新证书吊销列表前,才需要执行<br>    echo 01 &gt; /etc/pki/CA/crlnumber<br> 更新证书吊销列表<br>    openssl ca -gencrl -out /etc/pki/CA/crl.pem<br> 查看crl文件:<br>    openssl crl -in /etc/pki/CA/crl.pem -noout -text</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/%E5%8A%A0%E5%AF%86%E4%B8%8E%E5%AE%89%E5%85%A8-%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E5%8A%A0%E5%AF%86%E4%B8%8E%E5%AE%89%E5%85%A8-%E4%B8%80/" class="post-title-link" itemprop="url">加密与安全(一)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-11 13:18:49" itemprop="dateCreated datePublished" datetime="2018-09-11T13:18:49+08:00">2018-09-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-09-20 19:30:36" itemprop="dateModified" datetime="2018-09-20T19:30:36+08:00">2018-09-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>关于安全,首先要介绍以下墨菲定律:</p>
<p>墨菲定律:一种心理学效应,是由爱德华·墨菲(Edward A. Murphy)提出的,原话:如果有两种或两种以上的方式去做某件事情,而其中一种选择方式将导致灾难,则必定有人会做出这种选择<br>主要内容:<br>任何事都没有表面看起来那么简单<br>所有的事都会比你预计的时间长<br>会出错的事总会出错<br>如果你担心某种情况发生,那么它就更有可能发生</p>
<h3 id="安全机制"><a href="#安全机制" class="headerlink" title="安全机制"></a>安全机制</h3><p>信息安全防护的目标<br>保密性         Confidentiality<br>完整性         Integrity<br>可用性         Usability<br>可控制性     Controlability<br>不可否认性     Non-repudiation<br>安全防护环节<br>物理安全:各种设备/主机、机房环境<br>系统安全:主机或设备的操作系统<br>应用安全:各种网络服务、应用程序<br>网络安全:对网络访问的控制、防火墙规则<br>数据安全:信息的备份与恢复、加密解密<br>管理安全:各种保障性的规范、流程、方法</p>
<h3 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h3><p>安全攻击: STRIDE<br>Spoofing                      假冒<br>Tampering                      篡改<br>Repudiation                      否认<br>Information Disclosure         信息泄漏<br>Denial of Service                      拒绝服务<br>Elevation of Privilege              提升权限</p>
<h4 id="安全设计基本原则"><a href="#安全设计基本原则" class="headerlink" title="安全设计基本原则"></a>安全设计基本原则</h4><p>使用成熟的安全系统<br>以小人之心度输入数据<br>外部系统是不安全的<br>最小授权<br>减少外部接口<br>缺省使用安全模式<br>安全不是似是而非<br>从STRIDE思考<br>在入口处检查<br>从管理上保护好你的系统</p>
<h3 id="安全算法"><a href="#安全算法" class="headerlink" title="安全算法"></a>安全算法</h3><p><strong>常用安全技术</strong><br>    认证<br>    授权<br>    审计<br>    安全通信<br><strong>密码算法和协议</strong><br>    对称加密<br>    公钥加密<br>    单向加密<br>    认证协议</p>
<h4 id="对称加密算法"><a href="#对称加密算法" class="headerlink" title="对称加密算法"></a>对称加密算法</h4><p>对称加密:加密和解密使用同一个密钥<br>    DES:Data Encryption Standard,56bits<br>    3DES:<br>    AES:Advanced (128, 192, 256bits)<br>    Blowfish,Twofish<br>    IDEA,RC6,CAST5<br><strong>特性:</strong><br>    1、加密、解密使用同一个密钥,效率高<br>    2、将原始数据分割成固定大小的块,逐个进行加密<br><strong>缺陷:</strong><br>    1、密钥过多<br>    2、密钥分发<br>    3、数据来源无法确认</p>
<h4 id="非对称加密算法"><a href="#非对称加密算法" class="headerlink" title="非对称加密算法"></a>非对称加密算法</h4><p>公钥加密:密钥是成对出现<br>    公钥:公开给所有人；public key<br>    私钥:自己留存,必须保证其私密性；secret key<br><strong>特点</strong>:用公钥加密数据,只能使用与之配对的私钥解密；反之亦然<br><strong>功能:</strong><br>    数字签名:主要在于让接收方确认发送方身份<br>    对称密钥交换:发送方用对方的公钥加密一个对称密钥后发送给对方<br>    数据加密:适合加密较小数据<br><strong>缺点:</strong>密钥长,加密解密效率低下<br><strong>算法:</strong><br>    RSA(加密,数字签名)<br>    DSA(数字签名)<br>    ELGamal</p>
<h5 id="非对称加密实现"><a href="#非对称加密实现" class="headerlink" title="非对称加密实现"></a>非对称加密实现</h5><p>基于一对公钥/密钥对<br>    • 用密钥对中的一个加密,另一个解密<br>实现加密:<br>    • 接收者<br>        生成公钥/密钥对:P和S<br>        公开公钥P,保密密钥S<br>    • 发送者<br>        使用接收者的公钥来加密消息M<br>        将P(M)发送给接收者<br>    • 接收者<br>        使用密钥S来解密:M=S(P(M))</p>
<p>实现数字签名:<br>    • 发送者<br>        生成公钥/密钥对:P和S<br>        公开公钥P,保密密钥S<br>        使用密钥S来加密消息M<br>        发送给接收者S(M)<br>    • 接收者<br>        使用发送者的公钥来解密M=P(S(M))<br>结合签名和加密<br>分离签名</p>
<h4 id="单向散列"><a href="#单向散列" class="headerlink" title="单向散列"></a>单向散列</h4><p>将任意数据缩小成固定大小的“指纹”<br>    • 任意长度输入<br>    • 固定长度输出<br>    • 若修改数据,指纹也会改变(“不会产生冲突”)<br>    • 无法从指纹中重新生成数据(“单向”)<br>功能:数据完整性<br>常见算法<br>    md5: 128bits、sha1: 160bits、sha224、sha256、sha384、sha512<br>常用工具<br>    • md5sum | sha1sum [ –check ] file<br>    • openssl、gpg<br>    • rpm -V</p>
<h4 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h4><p><img data-src="https://github.com/Markupzh/Markupzh.github.io/blob/master/photo/post_secure_safe_01.png" alt=""></p>
<h4 id="密钥交换"><a href="#密钥交换" class="headerlink" title="密钥交换"></a>密钥交换</h4><p>密钥交换:IKE( Internet Key Exchange ) </p>
<p>公钥加密: DH (Deffie-Hellman):生成会话密钥,由惠特菲尔德·迪菲(Bailey Whitfield Diffie)和马丁·赫尔曼(Martin Edward Hellman)在1976年发表 参看:<a href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange</a> </p>
<p>DH: </p>
<p>A: g,p 协商生成公开的整数g, 大素数p  </p>
<p>B: g,p </p>
<p>A:生成隐私数据:a (a &lt; p),计算得出g^a%p,发送给B</p>
<p>B:生成隐私数据:b,计算得出 g^b%p, 发送给A</p>
<p>A:计算得出[(g^b%p)^a]%p=g^ab%p,生成为密钥</p>
<p>B:计算得出[(g^a%p)^b]%p=g^ab%p,生成为密钥</p>
<h4 id="应用程序-RPM"><a href="#应用程序-RPM" class="headerlink" title="应用程序: RPM"></a>应用程序: RPM</h4><p>文件完整性的两种实施方式<br>    被安装的文件<br>        • MD5单向散列<br>        • rpm –verify package_name (or -V)<br>    发行的软件包文件<br>        • GPG公钥签名<br>        • rpm –import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat*<br>        • rpm –checksig pakage_file_name (or -K)</p>
<h4 id="使用-gpg-实现对称加密"><a href="#使用-gpg-实现对称加密" class="headerlink" title="使用 gpg 实现对称加密"></a>使用 gpg 实现对称加密</h4><p>对称加密file文件<br>    gpg -c file<br>    ls file.gpg<br>在另一台主机上解密file<br>    gpg -o file -d file.gpg</p>
<h4 id="使用-gpg-工具实现公钥加密"><a href="#使用-gpg-工具实现公钥加密" class="headerlink" title="使用 gpg 工具实现公钥加密"></a>使用 gpg 工具实现公钥加密</h4><p><strong>在hostB主机上用公钥加密,在hostA主机上解密</strong></p>
<p>在hostA主机上生成公钥/私钥对<br>    gpg –gen-key<br>在hostA主机上查看公钥<br>    gpg –list-keys<br>在hostA主机上导出公钥到mark.pubkey<br>    gpg -a –export -o mark.pubkey<br>从hostA主机上复制公钥文件到需加密的B主机上<br>    scp mark.pubkey hostB:</p>
<p>在需加密数据的hostB主机上生成公钥/私钥对<br>    gpg –list-keys<br>    gpg –gen-key<br>在hostB主机上导入公钥<br>    gpg –import mark.pubkey<br>    gpg –list-keys<br>用从hostA主机导入的公钥,加密hostB主机的文件file,生成file.gpg<br>    gpg -e -r mark file<br>    file file.gpg</p>
<p>复制加密文件到hostA主机<br>    scp fstab.gpg hostA:<br>在hostA主机解密文件<br>    gpg -d file.gpg<br>    gpg -o file -d file.gpg<br>删除公钥和私钥<br>    gpg –delete-keys mark<br>    gpg –delete-secret-keys mark</p>
<h4 id="中间人攻击"><a href="#中间人攻击" class="headerlink" title="中间人攻击"></a>中间人攻击</h4><p><img data-src="https://github.com/Markupzh/Markupzh.github.io/blob/master/photo/post_secure_safe_02.png" alt=""></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/AWK-%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8-%E4%BA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/AWK-%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8-%E4%BA%8C/" class="post-title-link" itemprop="url">AWK 工具的使用(二)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2018-09-11 13:18:19 / 修改时间：16:46:20" itemprop="dateCreated datePublished" datetime="2018-09-11T13:18:19+08:00">2018-09-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="awk控制语句"><a href="#awk控制语句" class="headerlink" title="awk控制语句"></a>awk控制语句</h3><p>{ statements;… } 组合语句<br>if(condition) {statements;…}<br>if(condition) {statements;…} else {statements;…}<br>while(conditon) {statments;…}<br>do {statements;…} while(condition)<br>for(expr1;expr2;expr3) {statements;…}<br>break<br>continue<br>delete array[index]<br>delete array<br>exit</p>
<h3 id="awk控制语句-if-else"><a href="#awk控制语句-if-else" class="headerlink" title="awk控制语句 if-else"></a>awk控制语句 if-else</h3><p>语法:if(condition){statement;…}[else statement]<br>if(condition1){statement1}else if(condition2){statement2}<br>else{statement3}<br> 使用场景:对awk取得的整行或某个字段做条件判断<br> 例程:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">awk -F: '&#123;if($3&gt;=1000)print $1,$3&#125;' /etc/passwd</span><br><span class="line">awk -F: '&#123;if($NF=="/bin/bash") print $1&#125;' /etc/passwd</span><br><span class="line">awk '&#123;if(NF&gt;5) print $0&#125;' /etc/fstab</span><br><span class="line">awk -F: '&#123;if($3&gt;=1000) &#123;printf "Common user: %s\n",$1&#125; else &#123;printf "root or Sysuser: %s\n",$1&#125;&#125;'</span><br><span class="line">/etc/passwd</span><br><span class="line">awk -F: '&#123;if($3&gt;=1000) printf "Common user: %s\n",$1; else printf "root or Sysuser: %s\n",$1&#125;'</span><br><span class="line">/etc/passwd</span><br><span class="line">df -h|awk -F% '/^\/dev/&#123;print $1&#125;'|awk '$NF&gt;=80&#123;print $1,$5&#125;‘</span><br><span class="line">awk 'BEGIN&#123; test=100;if(test&gt;90)&#123;print "very good“&#125;else if(test&gt;60)&#123; print "good"&#125;else&#123;print "no pass"&#125;&#125;'</span><br></pre></td></tr></table></figure>



<h3 id="awk控制语句-while"><a href="#awk控制语句-while" class="headerlink" title="awk控制语句 while"></a>awk控制语句 while</h3><p>while循环<br>语法:while(condition){statement;…}<br>条件“真”,进入循环；条件“假”,退出循环<br>使用场景:<br>对一行内的多个字段逐一类似处理时使用<br>对数组中的各元素逐一处理时使用<br>示例:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">awk '/^[[:space:]]*linux16/&#123;i=1;while(i&lt;=NF)</span><br><span class="line">&#123;print $i,length($i); i++&#125;&#125;' /etc/grub2.cfg</span><br><span class="line">awk ‘/^[[:space:]]*linux16/&#123;i=1;while(i&lt;=NF) &#123;if(length($i)&gt;=10) &#123;print</span><br><span class="line"><span class="meta">$</span><span class="bash">i,length(<span class="variable">$i</span>)&#125;; i++&#125;&#125;’ /etc/grub2.cfg</span></span><br></pre></td></tr></table></figure>



<h3 id="awk控制语句-do-while"><a href="#awk控制语句-do-while" class="headerlink" title="awk控制语句 do-while"></a>awk控制语句 do-while</h3><p>do-while循环<br>语法:do {statement;…}while(condition)<br>意义:无论真假,至少执行一次循环体</p>
<p>例程:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'BEGIN&#123; total=0;i=0;do&#123; total+=i;i++;&#125;while(i&lt;=100);print total&#125;’</span><br></pre></td></tr></table></figure>

<p>for循环<br>语法:for(expr1;expr2;expr3) {statement;…}<br>常见用法:<br>for(variable assignment;condition;iteration process)<br>{for-body}<br>特殊用法:能够遍历数组中的元素<br>语法:for(var in array) {for-body}</p>
<p>例程:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk '/^[[:space:]]*linux16/&#123;for(i=1;i&lt;=NF;i++) &#123;print $i,length($i)&#125;&#125;'</span><br><span class="line">/etc/grub2.cfg</span><br></pre></td></tr></table></figure>

<h3 id="awk控制语句-switch"><a href="#awk控制语句-switch" class="headerlink" title="awk控制语句 switch"></a>awk控制语句 switch</h3><p>语法:switch(expression) {case VALUE1 or /REGEXP/: statement1; case<br>VALUE2 or /REGEXP2/: statement2; …; default: statementn}</p>
<p>break和continue<br>• awk ‘BEGIN{sum=0;for(i=1;i&lt;=100;i++)<br>    {if(i%2==0)continue;sum+=i}print sum}‘<br>• awk ‘BEGIN{sum=0;for(i=1;i&lt;=100;i++)<br>    {if(i==66)break;sum+=i}print sum}‘ </p>
<h3 id="awk控制语句-break-continue"><a href="#awk控制语句-break-continue" class="headerlink" title="awk控制语句 break continue"></a>awk控制语句 break continue</h3><p>break [n]<br>continue [n]<br>next:<br>提前结束对本行处理而直接进入下一行处理(awk自身循环)<br>awk -F: ‘{if($3%2!=0) next; print $1,$3}’ /etc/passwd</p>
<h3 id="性能比较"><a href="#性能比较" class="headerlink" title="性能比较"></a>性能比较</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">time (awk 'BEGIN&#123; total=0;for(i=0;i&lt;=10000;i++)&#123;total+=i;&#125;;print total;&#125;')</span><br><span class="line">time(total=0;for i in &#123;1..10000&#125;;do total=$(($total+i));done;echo $total)</span><br><span class="line">time(for ((i=0;i&lt;=10000;i++));do let total+=i;done;echo $total)</span><br><span class="line">time(seq –s ”+” 10000|bc)</span><br></pre></td></tr></table></figure>



<h3 id="awk数组"><a href="#awk数组" class="headerlink" title="awk数组"></a>awk数组</h3><p>关联数组:array[index-expression]<br>index-expression:<br>• (1) 可使用任意字符串；字符串要使用双引号括起来<br>• (2) 如果某数组元素事先不存在,在引用时,awk会自动创建此元素,并将其值<br>初始化为“空串”<br>• 若要判断数组中是否存在某元素,要使用“index in array”格式进行遍历</p>
<p>例程:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">weekdays[“mon”]="Monday“</span><br><span class="line">awk 'BEGIN&#123;weekdays["mon"]="Monday";</span><br><span class="line">weekdays["tue"]="Tuesday";print weekdays["mon"]&#125;‘</span><br><span class="line">awk ‘!arr[$0]++’ dupfile</span><br><span class="line">awk '&#123;!arr[$0]++;print $0, arr[$0]&#125;' dupfile</span><br></pre></td></tr></table></figure>

<p>若要遍历数组中的每个元素,要使用for循环<br>for(var in array) {for-body}<br>注意:var会遍历array的每个索引</p>
<p>例程:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">awk 'BEGIN&#123;weekdays["mon"]="Monday";weekdays["tue"]</span><br><span class="line">="Tuesday";for(i in weekdays) &#123;print weekdays[i]&#125;&#125;‘</span><br><span class="line">netstat -tan | awk '/^tcp/&#123;state[$NF]++&#125;END</span><br><span class="line">&#123;for(i in state) &#123; print i,state[i]&#125;&#125;'</span><br><span class="line">awk '&#123;ip[$1]++&#125;END&#123;for(i in ip) &#123;print i,ip[i]&#125;&#125;' /var/log/httpd/access_log</span><br></pre></td></tr></table></figure>



<h3 id="awk函数"><a href="#awk函数" class="headerlink" title="awk函数"></a>awk函数</h3><p>数值处理:<br>    rand():返回0和1之间一个随机数<br>awk ‘BEGIN{srand(); for (i=1;i&lt;=10;i++)print int(rand()*100) }’<br> 字符串处理:<br>• length([s]):返回指定字符串的长度<br>• sub(r,s,[t]):对t字符串进行搜索r表示的模式匹配的内容,并将第一个匹配的内容替换为s<br>    echo “2008:08:08 08:08:08” | awk ‘sub(/:/,“-“,$1)’<br>• gsub(r,s,[t]):对t字符串进行搜索r表示的模式匹配的内容,并全部替换为s所表示的内容<br>    echo “2008:08:08 08:08:08” | awk ‘gsub(/:/,“-“,$0)’<br>• split(s,array,[r]):以r为分隔符,切割字符串s,并将切割后的结果保存至array所表示的数组中,<br>第一个索引值为1,第二个索引值为2,…<br>    netstat -tan | awk ‘/^tcp&gt;/{split($5,ip,”:”);count[ip[1]]++}<br>END{for (i in count) {print i,count[i]}}’</p>
<p><strong>自定义函数</strong></p>
<p> 格式:<br>    function name ( parameter, parameter, … ) {<br>        statements<br>        return expression<br>    }<br> 示例:<br>    cat fun.awk<br>    function max(v1,v2) {<br>        v1&gt;v2?var=v1:var=v2<br>        return var<br>    }<br>    BEGIN{a=3;b=2;print max(a,b)}<br>awk –f fun.awk</p>
<h3 id="awk中调用shell命令"><a href="#awk中调用shell命令" class="headerlink" title="awk中调用shell命令"></a>awk中调用shell命令</h3><p>system命令<br>空格是awk中的字符串连接符,如果system中需要使用awk中的变量可以使用<br>空格分隔,或者说除了awk的变量外其他一律用””引用起来.<br>    awk BEGIN’{system(“hostname”) }’<br>    awk ‘BEGIN{score=100; system(“echo your score is “ score) }</p>
<h3 id="awk脚本"><a href="#awk脚本" class="headerlink" title="awk脚本"></a>awk脚本</h3><p>将awk程序写成脚本,直接调用或执行<br>示例:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat f1.awk</span><br><span class="line">	&#123;if($3&gt;=1000)print $1,$3&#125;</span><br><span class="line">awk -F: -f f1.awk /etc/passwd</span><br><span class="line"></span><br><span class="line">cat f2.awk</span><br><span class="line"><span class="meta">	#</span><span class="bash">!/bin/awk –f</span></span><br><span class="line"><span class="meta">	#</span><span class="bash">this is a awk script</span></span><br><span class="line">	&#123;if($3&gt;=1000)print $1,$3&#125;</span><br><span class="line">chmod +x f2.awk</span><br><span class="line">f2.awk –F: /etc/passwd</span><br></pre></td></tr></table></figure>



<h3 id="向awk脚本传递参数"><a href="#向awk脚本传递参数" class="headerlink" title="向awk脚本传递参数"></a>向awk脚本传递参数</h3><p>格式:<br>    awkfile var=value var2=value2… Inputfile<br>注意:在BEGIN过程中不可用.直到首行输入完成以后,变量才可用.可以通过-v 参数,让awk在执行BEGIN之前得到变量的值.命令行中每一个指定的变量都需要一个-v参数<br>示例:<br>    cat test.awk<br>    #!/bin/awk –f<br>    {if($3 &gt;=min &amp;&amp; $3&lt;=max)print $1,$3}<br>    chmod +x test.awk<br>    test.awk -F: min=100 max=200 /etc/passwd</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/AWK-%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8-%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/AWK-%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8-%E4%B8%80/" class="post-title-link" itemprop="url">AWK 工具的使用(一)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2018-09-11 13:18:12 / 修改时间：16:46:22" itemprop="dateCreated datePublished" datetime="2018-09-11T13:18:12+08:00">2018-09-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="AWK介绍"><a href="#AWK介绍" class="headerlink" title="AWK介绍"></a>AWK介绍</h3><p>awk:Aho, Weinberger, Kernighan,报告生成器,格式化文本输出<br> 有多种版本:New awk(nawk),GNU awk( gawk)<br> gawk:模式扫描和处理语言<br> 基本用法:<br>    awk [options] ‘program’ var=value file…<br>    awk [options] -f programfile var=value file…<br>    awk [options] ‘BEGIN{ action;… } pattern{ action;… } END{ action;… }’ file …<br>    awk 程序通常由:BEGIN语句块、能够使用模式匹配的通用语句块、END语句块,共3部分组成<br>    program通常是被单引号或双引号中<br> 选项:<br>    -F 指明输入时用到的字段分隔符<br>    -v var=value: 自定义变量</p>
<h3 id="awk语言"><a href="#awk语言" class="headerlink" title="awk语言"></a>awk语言</h3><p>基本格式:awk [options] ‘program’ file…<br>program:pattern{action statements;..}<br>pattern和action:<br>• pattern部分决定动作语句何时触发及触发事件<br>    BEGIN,END<br>• action statements对数据进行处理,放在{}内指明<br>    print, printf<br>分割符、域和记录<br>• awk执行时,由分隔符分隔的字段(域)标记$1,$2..$n称为域标识.$0为所有域,注意:和shell中变量$符含义不同<br>• 文件的每一行称为记录<br>• 省略action,则默认执行 print $0 的操作</p>
<h3 id="awk工作原理"><a href="#awk工作原理" class="headerlink" title="awk工作原理"></a>awk工作原理</h3><p>第一步:执行BEGIN{action;… }语句块中的语句</p>
<p>第二步:从文件或标准输入(stdin)读取一行,然后执行pattern{ action;… }语句块,它逐行扫描文件,从第一行到最后一行重复这个过程,直到文件全部被读取完毕.</p>
<p>第三步:当读至输入流末尾时,执行END{action;…}语句块</p>
<p>BEGIN语句块在awk开始从输入流中读取行之前被执行,这是一个可选的语句块,比如变量初始化、打印输出表格的表头等语句通常可以写在BEGIN语句块中</p>
<p>END语句块在awk从输入流中读取完所有的行之后即被执行,比如打印所有行的分析结果这类信息汇总都是在END语句块中完成,它也是一个可选语句块</p>
<p>pattern语句块中的通用命令是最重要的部分,也是可选的.如果没有提供pattern语句块,则默认执行{ print },即打印每一个读取到的行,awk读取的每一行都会执行该语句块</p>
<h3 id="awk格式与示例"><a href="#awk格式与示例" class="headerlink" title="awk格式与示例"></a>awk格式与示例</h3><p>print格式: print item1, item2, …<br> 要点:<br>    (1) 逗号分隔符<br>    (2) 输出的各item可以字符串,也可以是数值；当前记录的字段、变量或awk的表达式<br>    (3) 如省略item,相当于print $0<br> 示例:<br>    awk ‘{print “hello,awk”}’<br>    awk –F: ‘{print}’ /etc/passwd<br>    awk –F: ‘{print “wang”}’ /etc/passwd<br>    awk –F: ‘{print $1}’ /etc/passwd<br>    awk –F: ‘{print $0}’ /etc/passwd<br>    awk –F: ‘{print $1”\t”$3}’ /etc/passwd<br>    tail –3 /etc/fstab |awk ‘{print $2,$4}’</p>
<h3 id="awk变量与参数"><a href="#awk变量与参数" class="headerlink" title="awk变量与参数"></a>awk变量与参数</h3><p>变量:内置和自定义变量<br> FS:输入字段分隔符,默认为空白字符<br>    awk -v FS=’:’ ‘{print $1,FS,$3}’ /etc/passwd<br>    awk –F: ‘{print $1,$3,$7}’ /etc/passwd<br> OFS:输出字段分隔符,默认为空白字符<br>    awk -v FS=‘:’ -v OFS=‘:’ ‘{print $1,$3,$7}’ /etc/passwd<br> RS:输入记录分隔符,指定输入时的换行符<br>    awk -v RS=’ ‘ ‘{print }’ /etc/passwd<br> ORS:输出记录分隔符,输出时用指定符号代替换行符<br>    awk -v RS=’ ‘ -v ORS=’###’‘{print }’ /etc/passwd<br> NF:字段数量<br>    awk -F: ‘{print NF}’ /etc/fstab,引用内置变量不用$<br>    awk -F: ‘{print $(NF-1)}’ /etc/passwd<br> NR:记录号<br>    awk ‘{print NR}’ /etc/fstab ; awk END’{print NR}’ /etc/fstab</p>
<p>FNR:各文件分别计数,记录号<br>    awk ‘{print FNR}’ /etc/fstab /etc/inittab<br>FILENAME:当前文件名<br>    awk ‘{print FILENAME}’ /etc/fstab<br>ARGC:命令行参数的个数<br>    awk ‘{print ARGC}’ /etc/fstab /etc/inittab<br>    awk ‘BEGIN {print ARGC}’ /etc/fstab /etc/inittab<br>ARGV:数组,保存的是命令行所给定的各参数<br>    awk ‘BEGIN {print ARGV[0]}’ /etc/fstab /etc/inittab<br>    awk ‘BEGIN {print ARGV[1]}’ /etc/fstab /etc/inittab</p>
<p>自定义变量(区分字符大小写)<br>    (1) -v var=value<br>    (2) 在program中直接定义<br>示例:<br>    awk -v test=’hello gawk’ ‘{print test}’ /etc/fstab<br>    awk -v test=’hello gawk’ ‘BEGIN{print test}’<br>    awk ‘BEGIN{test=”hello,gawk”;print test}’<br>    awk –F:‘{sex=“male”;print $1,sex,age;age=18}’    /etc/passwd<br>    cat awkscript<br>    {print script,$1,$2}<br>    awk -F: -f awkscript script=“awk” /etc/passwd</p>
<h3 id="printf命令"><a href="#printf命令" class="headerlink" title="printf命令"></a>printf命令</h3><p>格式化输出:printf “FORMAT”, item1, item2, …<br>    (1) 必须指定FORMAT<br>    (2) 不会自动换行,需要显式给出换行控制符,\n<br>    (3) FORMAT中需要分别为后面每个item指定格式符<br> 格式符:与item一一对应<br>    %c: 显示字符的ASCII码<br>    %d, %i: 显示十进制整数<br>    %e, %E:显示科学计数法数值<br>    %f:显示为浮点数<br>    %g, %G:以科学计数法或浮点形式显示数值<br>    %s:显示字符串<br>    %u:无符号整数<br>    %%: 显示%自身<br> 修饰符:<br>    #[.#]:第一个数字控制显示的宽度；第二个#表示小数点后精度,%3.1f<br>    -: 左对齐(默认右对齐) %-15s<br>    +:显示数值的正负符号 %+d</p>
<h3 id="printf示例"><a href="#printf示例" class="headerlink" title="printf示例"></a>printf示例</h3><p>awk -F: ‘{printf “%s”,$1}’ /etc/passwd<br>awk -F: ‘{printf “%s\n”,$1}’ /etc/passwd<br>awk -F: ‘{printf “%-20s %10d\n”,$1,$3}’ /etc/passwd<br>awk -F: ‘{printf “Username: %s\n”,$1}’ /etc/passwd<br>awk -F: ‘{printf “Username: %s,UID:%d\n”,$1,$3}’ /etc/passwd<br>awk -F: ‘{printf “Username: %15s,UID:%d\n”,$1,$3}’ /etc/passwd<br>awk -F: ‘{printf “Username: %-15s,UID:%d\n”,$1,$3}’ /etc/passwd</p>
<h3 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h3><p>算术操作符:<br>    x+y, x-y, x*y, x/y, x^y, x%y<br>    -x: 转换为负数<br>    +x: 转换为数值<br>字符串操作符:没有符号的操作符,字符串连接<br>赋值操作符:<br>    =, +=, -=, *=, /=, %=, ^=<br>    ++, –<br>比较操作符:<br>    ==, !=, &gt;, &gt;=, &lt;, &lt;=<br>模式匹配符:<br>    <del>:左边是否和右边匹配包含 !</del>:是否不匹配<br>示例:<br>    awk –F: ‘$0 ~ /root/{print $1}‘ /etc/passwd<br>    awk ‘$0<del>“^root”‘ /etc/passwd<br>    awk ‘$0 !</del> /root/‘ /etc/passwd<br>    awk –F: ‘$3==0’ /etc/passwd</p>
<p>逻辑操作符:与&amp;&amp;,或||,非!<br> 示例:<br>• awk –F: ‘$3&gt;=0 &amp;&amp; $3&lt;=1000 {print $1}’ /etc/passwd<br>• awk -F: ‘$3==0 || $3&gt;=1000 {print $1}’ /etc/passwd<br>• awk -F: ‘!($3==0) {print $1}’ /etc/passwd<br>• awk -F: ‘!($3&gt;=500) {print $3}’ /etc/passwd<br> 函数调用: function_name(argu1, argu2, …)<br> 条件表达式(三目表达式):<br>    selector?if-true-expression:if-false-expression<br>• 示例:<br>    awk -F: ‘{$3&gt;=1000?usertype=”Common User”:usertype=”Sysadmin or SysUser”;printf<br>“%15s:%-s\n”,$1,usertype}’ /etc/passwd</p>
<h3 id="awk-PATTERN"><a href="#awk-PATTERN" class="headerlink" title="awk PATTERN"></a>awk PATTERN</h3><p>PATTERN:根据pattern条件,过滤匹配的行,再做处理<br>(1)如果未指定:空模式,匹配每一行<br>(2) /regular expression/:仅处理能够模式匹配到的行,需要用/ /括起来<br>    awk ‘/^UUID/{print $1}’ /etc/fstab<br>    awk ‘!/^UUID/{print $1}’ /etc/fstab<br>(3) relational expression: 关系表达式,结果为“真”才会被处理<br>    真:结果为非0值,非空字符串<br>    假:结果为空字符串或0值<br> 示例:<br>• awk -F: ‘i=1;j=1{print i,j}’ /etc/passwd<br>• awk ‘!0’ /etc/passwd ; awk ‘!1’ /etc/passwd<br>• awk –F: ‘$3&gt;=1000{print $1,$3}’ /etc/passwd<br>• awk -F: ‘$3&lt;1000{print $1,$3}’ /etc/passwd<br>• awk -F: ‘$NF==”/bin/bash”{print $1,$NF}’ /etc/passwd<br>• awk -F: ‘$NF ~ /bash$/{print $1,$NF}’ /etc/passwd</p>
<p>4) line ranges:行范围<br>    startline,endline:/pat1/,/pat2/ 不支持直接给出数字格式<br>    awk -F: ‘/^root&gt;/,/^nobody&gt;/{print $1}’ /etc/passwd<br>    awk -F: ‘(NR&gt;=10&amp;&amp;NR&lt;=20){print NR,$1}’ /etc/passwd<br>(5) BEGIN/END模式<br>    BEGIN{}: 仅在开始处理文件中的文本之前执行一次<br>    END{}:仅在文本处理完成之后执行一次</p>
<p>awk例程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">awk -F : 'BEGIN &#123;print "USER USERID"&#125; &#123;print $1":"$3&#125; END&#123;print "end file"&#125;'</span><br><span class="line">/etc/passwd</span><br><span class="line">awk -F : '&#123;print "USER USERID“;print $1":"$3&#125; END&#123;print "end file"&#125;' /etc/passwd</span><br><span class="line">awk -F: 'BEGIN&#123;print " USER UID \n--------------- "&#125;&#123;print $1,$3&#125;' /etc/passwd</span><br><span class="line">awk -F: 'BEGIN&#123;print " USER UID \n--------------- "&#125;&#123;print $1,$3&#125;'END&#123;print</span><br><span class="line">"=============="&#125; /etc/passwd</span><br><span class="line">seq 10 |awk ‘i=0’</span><br><span class="line">seq 10 |awk ‘i=1’</span><br><span class="line">seq 10 | awk 'i=!i‘</span><br><span class="line">seq 10 | awk '&#123;i=!i;print i&#125;‘</span><br><span class="line">seq 10 | awk ‘!(i=!i)’</span><br><span class="line">seq 10 |awk -v i=1 'i=!i'</span><br></pre></td></tr></table></figure>



<h3 id="awk-action"><a href="#awk-action" class="headerlink" title="awk action"></a>awk action</h3><p>常用的action分类<br>• (1) Expressions:算术,比较表达式等<br>• (2) Control statements:if, while等<br>• (3) Compound statements:组合语句<br>• (4) input statements<br>• (5) output statements:print等</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/SELinux-%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/SELinux-%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">SELinux 简介</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2018-09-11 13:17:49 / 修改时间：16:09:27" itemprop="dateCreated datePublished" datetime="2018-09-11T13:17:49+08:00">2018-09-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="SELinux介绍"><a href="#SELinux介绍" class="headerlink" title="SELinux介绍"></a>SELinux介绍</h3><p>SELinux: Secure Enhanced Linux, 是美国国家安全局(NSA=The National Security Agency)和SCC(Secure Computing Corporation)开发的 Linux的一个强制访问控制的安全模块.2000年以GNU GPL发布,Linux内核2.6版本后集成在内核中<br>DAC:Discretionary Access Control自由访问控制<br>MAC:Mandatory Access Control 强制访问控制<br>• DAC环境下进程是无束缚的<br>• MAC环境下策略的规则决定控制的严格程度<br>• MAC环境下进程可以被限制的<br>• 策略被用来定义被限制的进程能够使用那些资源(文件和端口)<br>• 默认情况下,没有被明确允许的行为将被拒绝</p>
<h3 id="SELinux工作类型"><a href="#SELinux工作类型" class="headerlink" title="SELinux工作类型"></a>SELinux工作类型</h3><p>SELinux有四种工作类型:<br>    strict: centos5,每个进程都受到selinux的控制<br>    targeted: 用来保护常见的网络服务,仅有限进程受到selinux控制,只监控容易被入侵的进程,centos4只保护13个服务,centos5保护88个服务<br>    minimum:centos7,修改的targeted,只对选择的网络服务<br>    mls:提供MLS(多级安全)机制的安全性<br>targeted为默认类型,minimum和mls稳定性不足,未加以应用,strict已不再使用</p>
<h3 id="SELinux安全上下文"><a href="#SELinux安全上下文" class="headerlink" title="SELinux安全上下文"></a>SELinux安全上下文</h3><p>传统Linux,一切皆文件,由用户,组,权限控制访问<br>在SELinux中,一切皆对象(object),由存放在inode的扩展属性域的安全元素所控制其访问<br>所有文件和端口资源和进程都具备安全标签:安全上下文(security context)<br>安全上下文有五个元素组成:<br>    user:role:type:sensitivity:category<br>    user_u:object_r:tmp_t:s0:c0<br> 实际上下文:存放在文件系统中,ls –Z;ps –Z<br>期望(默认)上下文:存放在二进制的SELinux策略库(映射目录和期望安全上下<br>文)中<br>    semanage fcontext –l</p>
<h3 id="五个安全元素"><a href="#五个安全元素" class="headerlink" title="五个安全元素"></a>五个安全元素</h3><p>User:指示登录系统的用户类型,进程:如system_u为系统服务进程,是受到管制的,unconfined_u为不管制的进程,用户自己开启的,如 bash,文件:system_u系统进程创建的文件, unconfined_u为用户自已创建的文件<br>Role:定义文件,进程和用户的用途:进程:system_r为系统服务进程,受到管制.unconfined_r 为不管制进程,通常都是用户自己开启的,如 bash,文件:object_r<br>Type:指定数据类型,规则中定义何种进程类型访问何种文件Target策略基于type实现,多服务共用:public_content_t<br>Sensitivity:限制访问的需要,由组织定义的分层安全级别,如<br>unclassified,secret,top,secret, 一个对象有且只有一个sensitivity,分0-15级,s0最低,Target策略默认使用s0<br>Category:对于特定组织划分不分层的分类,如FBI Secret,NSA secret, 一个对象可以有多个categroy, c0-c1023共1024个分类, Target 策略不使用category</p>
<h3 id="SELinux策略"><a href="#SELinux策略" class="headerlink" title="SELinux策略"></a>SELinux策略</h3><p>对象(object):所有可以读取的对象,包括文件、目录和进程,端口等<br>主体:进程称为主体(subject)<br>SELinux中对所有的文件都赋予一个type的文件类型标签,对于所有的进程也赋予各自的一个domain的标签.domain标签能够执行的操作由安全策略里定义<br>当一个subject试图访问一个object,Kernel中的策略执行服务器将检查AVC (访问矢量缓存Access Vector Cache), 在AVC中,subject和object的权限被缓存(cached),查找“应用+文件”的安全环境.然后根据查询结果允许或拒绝访问<br>安全策略:定义主体读取对象的规则数据库,规则中记录了哪个类型的主体使用哪个方法读取哪一个对象是允许还是拒绝的,并且定义了哪种行为是充许或拒绝</p>
<h3 id="设置SELinux"><a href="#设置SELinux" class="headerlink" title="设置SELinux"></a>设置SELinux</h3><p>配置SELinux:<br>    SELinux是否启用<br>    给文件重新打安全标签<br>    给端口设置安全标签<br>    设定某些操作的布尔型开关<br>    SELinux的日志管理<br>SELinux的状态:<br>    enforcing: 强制,每个受限的进程都必然受限<br>    permissive: 允许,每个受限的进程违规操作不会被禁止,但会被记录于审<br>计日志<br>    disabled: 禁用</p>
<h3 id="配置SELinux"><a href="#配置SELinux" class="headerlink" title="配置SELinux"></a>配置SELinux</h3><p>相关命令:<br>    getenforce: 获取selinux当前状态<br>    sestatus :查看selinux状态<br>    setenforce 0|1<br>        0: 设置为permissive<br>        1: 设置为enforcing<br>配置文件:<br>    /boot/grub/grub.conf<br>        在kernel行使用selinux=0禁用SELinux<br>    /etc/selinux/config<br>    /etc/sysconfig/selinux<br>    SELINUX={disabled|enforcing|permissive}</p>
<h3 id="修改SELinux安全标签"><a href="#修改SELinux安全标签" class="headerlink" title="修改SELinux安全标签"></a>修改SELinux安全标签</h3><p>给文件重新打安全标签:<br>    chcon [OPTION]… [-u USER][-r ROLE] [-t TYPE] FILE…<br>    chcon [OPTION]… –reference=RFILE FILE…<br>    -R:递归打标<br>恢复目录或文件默认的安全上下文:<br>    restorecon [-R] /path/to/somewhere</p>
<h3 id="默认安全上下文查询与修改"><a href="#默认安全上下文查询与修改" class="headerlink" title="默认安全上下文查询与修改"></a>默认安全上下文查询与修改</h3><p>semanage:来自policycoreutils-python包<br>查看默认的安全上下文<br>    semanage fcontext –l<br>添加安全上下文<br>    semanage fcontext -a –t httpd_sys_content_t ‘/testdir(/.*)?’</p>
<pre><code>restorecon –Rv /testdir</code></pre><p>删除安全上下文<br>    semanage fcontext -d –t httpd_sys_content_t ‘/testdir(/.*)?’</p>
<h3 id="SElinux端口标签"><a href="#SElinux端口标签" class="headerlink" title="SElinux端口标签"></a>SElinux端口标签</h3><p>查看端口标签<br>    semanage port –l<br>添加端口<br>    semanage port -a -t port_label -p tcp|udp PORT<br>    semanage port -a -t http_port_t -p tcp 9527<br>删除端口<br>    semanage port -d -t port_label -p tcp|udp PORT<br>    semanage port -d -t http_port_t -p tcp 9527<br>修改现有端口为新标签<br>    semanage port -m -t port_label -p tcp|udp PORT<br>    semanage port -m -t http_port_t -p tcp 9527 </p>
<h3 id="SELinux布尔值"><a href="#SELinux布尔值" class="headerlink" title="SELinux布尔值"></a>SELinux布尔值</h3><p>布尔型规则:<br>    getsebool<br>    setsebool<br>查看bool命令:<br>    getsebool [-a][boolean]<br>    semanage boolean –l<br>    semanage boolean -l –C 查看修改过的布尔值<br>设置bool值命令:<br>    setsebool [-P] boolean value(on,off)<br>    setsebool [-P] Boolean=value(0,1)</p>
<h3 id="SELinux日志管理"><a href="#SELinux日志管理" class="headerlink" title="SELinux日志管理"></a>SELinux日志管理</h3><p>yum install setroubleshoot(重启生效)<br>将错误的信息写入/var/log/message<br>    grep setroubleshoot /var/log/messages<br>查看安全事件日志说明<br>    sealert -l UUID<br>扫描并分析日志<br>    sealert -a /var/log/audit/audit.log</p>
<h3 id="SELinux帮助"><a href="#SELinux帮助" class="headerlink" title="SELinux帮助"></a>SELinux帮助</h3><p>yum –y install selinux-policy-devel ( centos7.2)<br>yum –y install selinux-policy-doc<br>mandb | makewhatis<br>man -k _selinux</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/Linux-%E5%90%AF%E5%8A%A8%E5%92%8C%E5%86%85%E6%A0%B8%E7%AE%A1%E7%90%86-%E4%BA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Linux-%E5%90%AF%E5%8A%A8%E5%92%8C%E5%86%85%E6%A0%B8%E7%AE%A1%E7%90%86-%E4%BA%8C/" class="post-title-link" itemprop="url">Linux 启动和内核管理(二)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2018-09-11 13:17:08 / 修改时间：16:52:17" itemprop="dateCreated datePublished" datetime="2018-09-11T13:17:08+08:00">2018-09-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="grub-legacy"><a href="#grub-legacy" class="headerlink" title="grub legacy"></a>grub legacy</h3><p>CentOS 6启动流程：<br>POST –&gt; Boot Sequence(BIOS) –&gt; Boot Loader –&gt; Kernel(ramdisk)<br>–&gt; rootfs –&gt; switchroot –&gt; /sbin/init –&gt;(/etc/inittab, /etc/init/*.conf) –&gt; 设定默认运行级别 –&gt; 系统初始化脚本rc.sysinit –&gt; 关闭或启动对应级别的服务 –&gt; 启动终端<br>grub: GRand Unified Bootloader<br>    grub 0.97: grub legacy<br>    grub 2.x: grub2<br>    grub legacy:<br>        stage1: mbr<br>        stage1_5: mbr之后的扇区,让stage1中的bootloader能识别stage2所在的分区上的文件系统<br>        stage2：磁盘分区(/boot/grub/)</p>
<p>配置文件：/boot/grub/grub.conf &lt;– /etc/grub.conf<br>stage2及内核等通常放置于一个基本磁盘分区<br>功用：<br>(1) 提供启动菜单、并提供交互式接口<br>    a：内核参数<br>    e: 编辑模式,用于编辑菜单<br>    c: 命令模式,交互式接口<br>(2) 加载用户选择的内核或操作系统<br>    允许传递参数给内核<br>    可隐藏启动菜单<br>(3) 为菜单提供了保护机制<br>    为编辑启动菜单进行认证<br>    为启用内核或操作系统进行认证</p>
<p>grub的命令行接口<br>    help: 获取帮助列表<br>    help KEYWORD: 详细帮助信息<br>    find (hd#,#)/PATH/TO/SOMEFILE：<br>    root (hd#,#)<br>    kernel /PATH/TO/KERNEL_FILE: 设定本次启动时用到的内核文件；额外还可添加许多内核支持使用的cmdline参数<br>    例如：max_loop=100 selinux=0 init=/path/to/init<br>    initrd /PATH/TO/INITRAMFS_FILE: 设定为选定的内核提供额外文件的ramdisk<br>    boot: 引导启动选定的内核<br> cat /proc/cmdline 内核参数<br> 内核参数文档:/usr/share/doc/kernel-doc-.6.32/Documentation/kernelparameters.txt</p>
<p>识别硬盘设备<br>    (hd#,#)<br>    hd#: 磁盘编号,用数字表示；从0开始编号<br>    #: 分区编号,用数字表示: 从0开始编号<br>    (hd0,0) 第一块硬盘,第一个分区<br>手动在grub命令行接口启动系统<br>    grub&gt; root (hd#,#)<br>    grub&gt; kernel /vmlinuz-VERSION-RELEASE ro root=/dev/DEVICE<br>    grub&gt; initrd /initramfs-VERSION-RELEASE.img<br>    grub&gt; boot</p>
<h3 id="grub-安装"><a href="#grub-安装" class="headerlink" title="grub 安装"></a>grub 安装</h3><p>安装grub：<br>    (1) grub-install<br>    安装grub stage1和stage1_5到/dev/DISK磁盘上,并复制GRUB相关文件到 DIR/boot目录下<br>    grub-install –root-directory=DIR /dev/DISK<br>    (2) grub<br>    grub&gt; root (hd#,#)<br>    grub&gt; setup (hd#)</p>
<h3 id="grub-legacy配置文件"><a href="#grub-legacy配置文件" class="headerlink" title="grub legacy配置文件"></a>grub legacy配置文件</h3><p>配置文件：/boot/grub/grub.conf<br>default=#: 设定默认启动的菜单项；落单项(title)编号从0开始<br>timeout=#：指定菜单项等待选项选择的时长<br>splashimage=(hd#,#)/PATH/XPM_FILE：菜单背景图片文件路径<br>password [–md5] STRING: 启动菜单编辑认证<br>hiddenmenu：隐藏菜单<br>title TITLE：定义菜单项”标题”, 可出现多次<br>root (hd#,#)：查找stage2及kernel文件所在设备分区；为grub的根<br>kernel /PATH/TO/VMLINUZ_FILE [PARAMETERS]：启动的内核<br>initrd /PATH/TO/INITRAMFS_FILE: 内核匹配的ramfs文件<br>password [–md5|–encrypted ] STRING: 启动选定的内核或操作系统时进行认证</p>
<h3 id="自制linux系统"><a href="#自制linux系统" class="headerlink" title="自制linux系统"></a>自制linux系统</h3><p>分区并创建文件系统<br>    fdisk /dev/sdb<br>    分两个必要的分区<br>    /dev/sdb1对应/boot /dev/sdb2对应根 /<br>    mkfs.ext4 /dev/sdb1<br>    mkfs.ext4 /dev/sdb2<br>挂载boot<br>    mkdir /mnt/boot 子目录必须为boot<br>    mount /dev/sdb1 /mnt/boot<br>安装grub<br>    grub-install –root-directory=/mnt /dev/sdb</p>
<p>恢复内核和initramfs文件<br>    cp /boot/vmlinuz-2.6.32-642.el6.x86_64 /mnt/boot/<br>    cp /boot/initramfs-2.6.32-642.el6.x86_64.img /mnt/boot<br>建立grub.conf<br>    vim /mnt/boot/grub.conf<br>        title wanglinux<br>        root (hd0,0)<br>        kernel /vmlinuz-2.6.32-642.el6.x86_64 root=/dev/sda2 selinux=0 init=/bin/bash<br>        initrd /initramfs-2.6.32-642.el6.x86_64.img<br>chroot /mnt/sysroot</p>
<p>创建一级目录<br>    mkdir /mnt/sysroot<br>    mount /dev/sdb2 /mnt/sysroot<br>    mkdir –pv<br>/mnt/sysroot/{etc,lib,lib64,bin,sbin,tmp,var,usr,sys,proc,opt,home,root,boot,dev,mnt,media}<br>复制bash和相关库文件<br>复制相关命令及相关库文件<br>    如：ifconfig,insmod,ping,mount,ls,cat,df,lsblk,blkid等</p>
<h3 id="救援环境"><a href="#救援环境" class="headerlink" title="救援环境"></a>救援环境</h3><p>在根文件系统无法使用时需要,如/bin/mount删除<br>对系统没有特殊要求<br>从光盘引导（boot.iso或者安装光盘#1）<br>从USB盘（可由boot.iso制作）引导</p>
<p>文件系统重组<br>Anaconda将会询问是否应该挂载文件系统<br>/mnt/sysimage/*<br>/mnt/stage2<br>$PATH包括硬盘的目录<br>文件系统节点<br>提供系统特定的设备文件<br>mknod了解major/minor </p>
<h3 id="系统配置文件丢失修复"><a href="#系统配置文件丢失修复" class="headerlink" title="系统配置文件丢失修复"></a>系统配置文件丢失修复</h3><p>系统在引导期间,很重要的一个过程就是init进程读取其配置文件/etc/inittab,启动系统基本服务程序及默认运行级别的服务程序完成系统引导,如果/etc/inittab误删除或修改错误,Linux将无法正常启动.此时,只有通过救援模式才可以解决此类问题.<br>• 有备份文件的回复方法<br>• 没有备份文件的恢复办法</p>
<h4 id="有备份文件的恢复办法："><a href="#有备份文件的恢复办法：" class="headerlink" title="有备份文件的恢复办法："></a>有备份文件的恢复办法：</h4><p>进入救援模式,执行chroot命令后,如果有此文件的备份（强烈建议系统中的重要数据目录,如/etc、/boot等要进行备份）,直接将备份文件拷贝回去,退出重启即可.如果是配置文件修改错误,如比较典型的/boot/grub/grub.conf及/etc/passwd的文件修改错误,也可以直接修正恢复.假设有备份文件/etc/inittab.bak,则在救援模式下执行：<br>    chroot /mnt/sysimage<br>    cp /etc/inittab.bak /etc/inittab</p>
<h4 id="没有备份文件的恢复办法"><a href="#没有备份文件的恢复办法" class="headerlink" title="没有备份文件的恢复办法"></a>没有备份文件的恢复办法</h4><p>如果一些配置文件丢失或软件误删除,且无备份,可以通过重新安装软件包来恢复,首先查找到/etc/inittab属于哪一个RPM包<br>    chroot /mnt/sysimage</p>
<pre><code>rpm -qf /etc/inittab 查询到此文件来自initscripts包

exit 退出chroot模式

mount /dev/sr0 /mnt/source 挂载存放RPM包的安装光盘

rpm -ivh --replacepkgs | force /mnt/source/Packages/</code></pre><p>initscripts-9.03.49-1.el6.centos.x86_64.rpm CentOS6系统的要修复的硬盘系统的根目录在/mnt/sysimage下,需要使用–root选项指定其位置.覆盖安装/etc/inittab文件所在的RPM包,使用选项”—replacepkgs 或—force 表示覆盖安装</p>
<p>如果想只提取RPM包中的/etc/inittab文件进行恢复,可以在进入救援模式后,执行命令：</p>
<pre><code>rpm2cpio /mnt/source/Packages/initscripts-9.03.49-1.el6.centos.x86_64.rpm| cpio -idv ./etc/inittab

cp etc/inittab /mnt/sysimage/etc</code></pre><p>注意此命令执行时不能将文件直接恢复至/etc目录,只能提取到当前目录下,且恢复的文件名称所在路径要写完整的路径.提取文件成功后,将其复制到根分区所在的/mnt/sysimage目录下相应位置即可</p>
<h3 id="proc-目录"><a href="#proc-目录" class="headerlink" title="/proc 目录"></a>/proc 目录</h3><p>/proc目录：</p>
<p>内核把自己内部状态信息及统计信息,以及可配置参数通过proc伪文件系统加以输出</p>
<p>参数：</p>
<pre><code>只读：输出信息

可写：可接受用户指定&quot;新值&quot;来实现对内核某功能或特性的配置</code></pre><p>/proc/sys<br>    (1) sysctl命令用于查看或设定此目录中诸多参数</p>
<pre><code>sysctl -w path.to.parameter=VALUE

sysctl -w kernel.hostname=mail.magedu.com

(2) echo命令通过重定向方式也可以修改大多数参数的值

echo &quot;VALUE&quot; &gt; /proc/sys/path/to/parameter

echo &quot;websrv&quot; &gt; /proc/sys/kernel/hostname</code></pre><h3 id="sysctl命令"><a href="#sysctl命令" class="headerlink" title="sysctl命令"></a>sysctl命令</h3><p>sysctl命令：<br>    默认配置文件：/etc/sysctl.conf<br>    (1) 设置某参数<br>        sysctl -w parameter=VALUE<br>    (2) 通过读取配置文件设置参数<br>        sysctl -p [/path/to/conf_file]<br>    (3) 查看所有生效参数<br>        sysctl -a<br>常用的几个参数：<br>    net.ipv4.ip_forward<br>    net.ipv4.icmp_echo_ignore_all<br>    vm.drop_caches</p>
<h3 id="sys-目录"><a href="#sys-目录" class="headerlink" title="/sys 目录"></a>/sys 目录</h3><p>/sys目录：<br>    sysfs：为用户使用的伪文件系统,输出内核识别出的各硬件设备的相关属性信息,也有内核对硬件特性的设定信息；有些参数是可以修改的,用于调整硬件工作特性<br>    udev通过此路径下输出的信息动态为各设备创建所需要设备文件,udev是运行用户空间程序<br>    专用工具：udevadmin, hotplug<br>    udev为设备创建设备文件时,会读取其事先定义好的规则文件,一般在/etc/udev/rules.d及/usr/lib/udev/rules.d目录下</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/Linux-%E5%90%AF%E5%8A%A8%E5%92%8C%E5%86%85%E6%A0%B8%E7%AE%A1%E7%90%86-%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/mark_avatar.png">
      <meta itemprop="name" content="Mark">
      <meta itemprop="description" content="半吊子民工 英特纳雄耐尔就一定要实现">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mark blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Linux-%E5%90%AF%E5%8A%A8%E5%92%8C%E5%86%85%E6%A0%B8%E7%AE%A1%E7%90%86-%E4%B8%80/" class="post-title-link" itemprop="url">Linux 启动和内核管理(一)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2018-09-11 13:16:31 / 修改时间：16:55:07" itemprop="dateCreated datePublished" datetime="2018-09-11T13:16:31+08:00">2018-09-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E6%B5%B7%E6%8B%BE%E8%B4%9D/" itemprop="url" rel="index"><span itemprop="name">学海拾贝</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Linux组成"><a href="#Linux组成" class="headerlink" title="Linux组成"></a>Linux组成</h3><p>Linux: kernel+rootfs<br>    kernel: 进程管理、内存管理、网络管理、驱动程序、文件系统、安全功能<br>    rootfs:程序和glibc<br>    库：函数集合, function, 调用接口（头文件负责描述）<br>        过程调用：procedure,无返回值<br>        函数调用：function<br>    程序：二进制执行文件<br>内核设计流派：<br>    单内核(monolithic kernel)：Linux<br>        把所有功能集成于同一个程序<br>    微内核(micro kernel)：Windows, Solaris<br>        每种功能使用一个单独子系统实现</p>
<h3 id="内核"><a href="#内核" class="headerlink" title="内核"></a>内核</h3><p>Linux内核特点：<br>    支持模块化：.ko（内核对象）<br>        如：文件系统,硬件驱动,网络协议等<br>    支持内核模块的动态装载和卸载<br>组成部分：<br>核心文件：/boot/vmlinuz-VERSION-release<br>    ramdisk：辅助的伪根系统<br>    CentOS 5: /boot/initrd-VERSION-release.img<br>    CentOS 6,7: /boot/initramfs-VERSION-release.img<br>模块文件：/lib/modules/VERSION-release</p>
<h3 id="CentOS6启动流程"><a href="#CentOS6启动流程" class="headerlink" title="CentOS6启动流程"></a>CentOS6启动流程</h3><p>1.加载BIOS的硬件信息,获取第一个启动设备<br>2.读取第一个启动设备MBR的引导加载程序(grub)的启动信息<br>3.加载核心操作系统的核心信息,核心开始解压缩,并尝试驱动所有的硬件设备<br>4.核心执行init程序,并获取默认的运行信息<br>5.init程序执行/etc/rc.d/rc.sysinit文件<br>6.启动核心的外挂模块<br>7.init执行运行的各个批处理文件(scripts)<br>8.init执行/etc/rc.d/rc.local<br>9.执行/bin/login程序,等待用户登录<br>10.登录之后开始以Shell控制主机</p>
<h4 id="详细步骤"><a href="#详细步骤" class="headerlink" title="详细步骤"></a>详细步骤</h4><p> POST：Power-On-Self-Test,加电自检,是BIOS功能的一个主要部分.负责完成对CPU、主板、内存、硬盘子系统、显示子系统、串并行接口、键盘等硬件情况的检测<br>    ROM：BIOS,Basic Input and Output System,保存着有关计算机系统最重要的基本输入输出程序,系统信息设置、开机加电自检程序和系统启动自举程序等<br>    RAM：CMOS互补金属氧化物半导体,保存各项参数的设定<br>    按次序查找引导设备,第一个有引导程序的设备为本次启动设备<br> bootloader: 引导加载器,引导程序<br>    windows: ntloader,仅是启动OS<br>    Linux：功能丰富,提供菜单,允许用户选择要启动系统或不同的内核版本；把用户选定的内核装载到内存中的特定空间中,解压、展开,并把系统控制权移交给内核<br>        LILO：LInux LOader<br>        GRUB: GRand Unified Bootloader<br>            GRUB 0.X: GRUB Legacy, GRUB2</p>
<p>MBR:<br>    446: bootloader, 64: 分区表, 2: 55AA<br>GRUB:<br>    primary boot loader : 1st stage,1.5 stage<br>    secondary boot loader ：2nd stage,分区文件<br>kernel：<br>自身初始化：<br>    探测可识别到的所有硬件设备<br>    加载硬件驱动程序（借助于ramdisk加载驱动）<br>    以只读方式挂载根文件系统<br>    运行用户空间的第一个应用程序：/sbin/init</p>
<p>ramdisk：<br>内核中的特性之一：使用缓冲和缓存来加速对磁盘上的文件访问,并加载相应的硬件驱动<br>    ramdisk –&gt; ramfs 提高速度<br>    CentOS 5: initrd<br>        工具程序：mkinitrd<br>    CentOS 6,7: initramfs<br>        工具程序：mkinitrd, dracut<br>系统初始化：<br>POST –&gt; BootSequence (BIOS) –&gt; Bootloader(MBR) –&gt; kernel(ramdisk) –&gt; rootfs(只读) –&gt; init（systemd）</p>
<h3 id="ramdisk管理"><a href="#ramdisk管理" class="headerlink" title="ramdisk管理"></a>ramdisk管理</h3><p>ramdisk文件的制作：<br>(1) mkinitrd命令<br>    为当前正在使用的内核重新制作ramdisk文件<br>    mkinitrd /boot/initramfs-$(uname -r).img $(uname -r)<br>(2) dracut命令<br>    为当前正在使用的内核重新制作ramdisk文件<br>    dracut /boot/initramfs-$(uname -r).img $(uname -r) </p>
<h3 id="系统启动流程"><a href="#系统启动流程" class="headerlink" title="系统启动流程"></a>系统启动流程</h3><p>init程序的类型：</p>
<p>SysV: init, CentOS 5之前</p>
<pre><code>配置文件：/etc/inittab</code></pre><p>Upstart: init,CentOS 6</p>
<pre><code>配置文件：/etc/inittab, /etc/init/*.conf</code></pre><p>Systemd：systemd, CentOS 7</p>
<pre><code>配置文件：

    /usr/lib/systemd/system

    /etc/systemd/system</code></pre><h3 id="启动流程"><a href="#启动流程" class="headerlink" title="启动流程"></a>启动流程</h3><p>/sbin/init CentOS6之前<br>运行级别：为系统运行或维护等目的而设定；0-6：7个级别<br>    0：关机<br>    1：单用户模式(root自动登录), single, 维护模式<br>    2: 多用户模式,启动网络功能,但不会启动NFS；维护模式<br>    3：多用户模式,正常模式；文本界面<br>    4：预留级别；可同3级别<br>    5：多用户模式,正常模式；图形界面<br>    6：重启<br>默认级别：3, 5<br>切换级别：init #<br>查看级别：runlevel : who -r</p>
<h3 id="init初始化"><a href="#init初始化" class="headerlink" title="init初始化"></a>init初始化</h3><p>init读取其初始化文件：/etc/inittab<br>初始运行级别(RUN LEVEL)<br>系统初始化脚本<br>对应运行级别的脚本目录<br>捕获某个关键字顺序<br>定义UPS电源终端/恢复脚本<br>在虚拟控制台生成getty<br>在运行级别5初始化X</p>
<h3 id="CentOS-5-的inittab文件"><a href="#CentOS-5-的inittab文件" class="headerlink" title="CentOS 5 的inittab文件"></a>CentOS 5 的inittab文件</h3><p>配置文件：</p>
<pre><code>/etc/inittab</code></pre><p> 每一行格式： </p>
<pre><code>id:runlevel:action:process

id：是惟一标识该项的字符序列

runlevels： 定义了操作所使用的运行级别

action： 指定了要执行的特定操作

    wait: 切换至此级别运行一次</code></pre><p>​        respawn：此process终止,就重新启动之</p>
<pre><code>    initdefault：设定默认运行级别；process省略

    sysinit：设定系统初始化方式

process：定义了要执行的进程</code></pre><p> 示例：</p>
<pre><code>id:3:initdefault:

si::sysinit:/etc/rc.d/rc.sysinit

l0:0:wait:/etc/rc.d/rc 0

l1:1:wait:/etc/rc.d/rc 1...

l6:6:wait:/etc/rc.d/rc 6

ca::ctrlaltdel:/sbin/shutdown -t3 -r now</code></pre><p>CentOS 6 /etc/inittab和相关文件</p>
<p>/etc/inittab</p>
<pre><code>设置系统默认的运行级别

id:3:initdefault:</code></pre><p> 示例：</p>
<pre><code>破解CentOS5和6的root口令</code></pre><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/etc/init/control-alt-delete.conf</span><br><span class="line"></span><br><span class="line">/etc/init/tty.conf</span><br><span class="line"></span><br><span class="line">/etc/init/start-ttys.conf</span><br><span class="line"></span><br><span class="line">/etc/init/rc.conf</span><br><span class="line"></span><br><span class="line">/etc/init/prefdm.conf</span><br></pre></td></tr></table></figure>



<h3 id="启动流程-1"><a href="#启动流程-1" class="headerlink" title="启动流程"></a>启动流程</h3><p>/etc/rc.d/rc.sysinit: 系统初始化脚本<br>    (1) 设置主机名<br>    (2) 设置欢迎信息<br>    (3) 激活udev和selinux<br>    (4) 挂载/etc/fstab文件中定义的文件系统<br>    (5) 检测根文件系统,并以读写方式重新挂载根文件系统<br>    (6) 设置系统时钟<br>    (7) 激活swap设备<br>    (8) 根据/etc/sysctl.conf文件设置内核参数<br>    (9) 激活lvm及software raid设备<br>    (10) 加载额外设备的驱动程序<br>    (11) 清理操作</p>
<p>说明：rc N –&gt; 意味着读取/etc/rc.d/rcN.d/<br>    K<em>: K##*：##运行次序；数字越小,越先运行；数字越小的服务,通常为依赖到别的服务<br>    S</em>: S##<em>：##运行次序；数字越小,越先运行；数字越小的服务,通常为被依赖到的服务<br>    for srv in /etc/rc.d/rcN.d/K</em>: do<br>        $srv stop<br>    done<br>    for srv in /etc/rc.d/rcN.d/S*: do<br>        $srv start<br>    done</p>
<h3 id="chkconfig命令"><a href="#chkconfig命令" class="headerlink" title="chkconfig命令"></a>chkconfig命令</h3><p>ntsysv命令<br> chkconfig命令<br> 查看服务在所有级别的启动或关闭设定情形：<br>    chkconfig [–list][name]<br> 添加：<br>    SysV的服务脚本放置于/etc/rc.d/init.d (/etc/init.d)<br>    chkconfig –add name<br>        #!/bin/bash</p>
<p>​        #LLLL 表示初始在哪个级别下启动,-表示都不启动</p>
<pre><code># chkconfig: LLLL nn nn</code></pre><p> 删除：<br>    chkconfig –del name<br> 修改指定的链接类型<br>    chkconfig [–level levels] name<br>        –level LLLL: 指定要设置的级别；省略时表示2345</p>
<h3 id="xinetd管理的服务"><a href="#xinetd管理的服务" class="headerlink" title="xinetd管理的服务"></a>xinetd管理的服务</h3><p>service 命令：手动管理服务<br>    service 服务 start|stop|restart<br>    service –status-all<br>瞬态（Transient）服务被xinetd进程所管理<br>进入的请求首先被xinetd代理<br>配置文件：/etc/xinetd.conf、/etc/xinetd.d/<br>与libwrap.so文件链接<br>用chkconfig控制的服务：<br>示例：chkconfig tftp on</p>
<h3 id="启动流程-2"><a href="#启动流程-2" class="headerlink" title="启动流程"></a>启动流程</h3><p>注意：正常级别下,最后启动一个服务S99local没有链接至/etc/rc.d/init.d一个<br>服务脚本,而是指向了/etc/rc.d/rc.local脚本<br>不便或不需写为服务脚本放置于/etc/rc.d/init.d/目录,且又想开机时自动运行<br>的命令,可直接放置于/etc/rc.d/rc.local文件中<br>• /etc/rc.d/rc.local在指定运行级别脚本后运行<br>• 可以根据情况,进行自定义修改</p>
<p>1:2345:respawn:/usr/sbin/mingetty tty1<br>2:2345:respawn:/usr/sbin/mingetty tty2<br>…<br>6:2345:respawn:/usr/sbin/mingetty tty6<br>    mingetty会自动调用login程序<br>x:5:respawn:/etc/X11/prefdm -nodaemon</p>
<h3 id="启动过程"><a href="#启动过程" class="headerlink" title="启动过程"></a>启动过程</h3><p>总结：/sbin/init –&gt; (/etc/inittab) –&gt; 设置默认运行级别 –&gt; 运行系统初始脚本、完成系统初始化 –&gt; (关闭对应下需要关闭的服务)启动需要启动服务 –&gt; 设置登录终端<br>CentOS 6 init程序为: upstart, 其配置文件：<br>/etc/inittab, /etc/init/*.conf,配置文件的语法 遵循 upstart配置文件语法格式,和CentOS5不同</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mark"
      src="/images/mark_avatar.png">
  <p class="site-author-name" itemprop="name">Mark</p>
  <div class="site-description" itemprop="description">半吊子民工 英特纳雄耐尔就一定要实现</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">60</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:markupzh@gmail.com" title="E-Mail → mailto:markupzh@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mark</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
